<!doctype html><html lang=en-uk><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="What is a closure, and how does it work?"><title>Closures explained</title><link rel=canonical href=https://always-developing.github.io/dailydrop/2022/03/16-closures/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Closures explained"><meta property="og:description" content="What is a closure, and how does it work?"><meta property="og:url" content="https://always-developing.github.io/dailydrop/2022/03/16-closures/"><meta property="og:site_name" content="Always Developing"><meta property="og:type" content="article"><meta property="article:section" content="Dailydrop"><meta property="article:tag" content="c#"><meta property="article:tag" content=".net"><meta property="article:tag" content="dailydrop"><meta property="article:tag" content="closure"><meta property="article:tag" content="method"><meta property="article:tag" content="function"><meta property="article:published_time" content="2022-03-16T01:00:00+02:00"><meta property="article:modified_time" content="2022-03-16T01:00:00+02:00"><meta name=twitter:title content="Closures explained"><meta name=twitter:description content="What is a closure, and how does it work?"><link rel="shortcut icon" href=favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-CXPLFS7K38"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CXPLFS7K38",{anonymize_ip:!1})}</script></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"dark")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://always-developing.github.io/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/dailydrop/>DailyDrop</a></header><h2 class=article-title><a href=/dailydrop/2022/03/16-closures/>Closures explained</a></h2><h3 class=article-subtitle>What is a closure, and how does it work?</h3><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Mar 16, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><h2 id=daily-knowledge-drop>Daily Knowledge Drop</h2><p>A <strong>closure</strong> is a particular type of <code>first class function</code>, which is <code>linked to the environment</code> in which it was declared, and as such can <code>reference variables in this environment, even if outside the scope</code> of the function.</p><hr><h2 id=first-class-function>First class function</h2><p>A closure is a <code>first class function</code> - this basically means C# treats the function as a data type, and as such can be used as if it were a data type. It can be assigned to a variable, passed as a parameter etc.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3>3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4>4</a>
</span><span class=lnt id=ienumusage-5><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-5>5</a>
</span><span class=lnt id=ienumusage-6><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-6>6</a>
</span><span class=lnt id=ienumusage-7><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=kt>var</span> <span class=n>func1</span> <span class=p>=</span> <span class=n>GetFunction</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>func1</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Func</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>GetFunction</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s>&#34;String created by GetFunction&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>Line 4</strong>: A method is defined, which returns a <em>Func&lt;string></em>. <em>Func&lt;string></em> is a shortcut for a method, which takes no parameters and returns a string. So the <em>GetFunction</em> method, will return another method (as a variable), which takes no parameters and returns as string</li><li><strong>Line 6</strong>: The <em>Func&lt;string></em> is defined, an anonymous method, which takes no parameters and returns a string</li><li><strong>Line 1</strong>: <em>GetFunction</em> is called and the returned function is assigned to variable <em>func1</em></li><li><strong>Line 2</strong>: <em>func1</em> is invoked, and the returning string output to the console</li></ul><p>The output is as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-posh data-lang=posh><span class=line><span class=cl>    <span class=n>String</span> <span class=n>created</span> <span class=n>by</span> <span class=n>GetFunction</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=variables-outside-scope>Variables outside scope</h2><p>Looks look at some more examples, this time where the function <code>uses a variable outside of its scope</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1> 1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2> 2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3> 3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4> 4</a>
</span><span class=lnt id=ienumusage-5><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-5> 5</a>
</span><span class=lnt id=ienumusage-6><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-6> 6</a>
</span><span class=lnt id=ienumusage-7><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-7> 7</a>
</span><span class=lnt id=ienumusage-8><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-8> 8</a>
</span><span class=lnt id=ienumusage-9><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-9> 9</a>
</span><span class=lnt id=ienumusage-10><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-10>10</a>
</span><span class=lnt id=ienumusage-11><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-11>11</a>
</span><span class=lnt id=ienumusage-12><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-12>12</a>
</span><span class=lnt id=ienumusage-13><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-13>13</a>
</span><span class=lnt id=ienumusage-14><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-14>14</a>
</span><span class=lnt id=ienumusage-15><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-15>15</a>
</span><span class=lnt id=ienumusage-16><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-16>16</a>
</span><span class=lnt id=ienumusage-17><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=kt>var</span> <span class=n>func2</span> <span class=p>=</span> <span class=n>GetFunction2</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>func2</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>func3</span> <span class=p>=</span> <span class=n>GetFunction3</span><span class=p>(</span><span class=m>17</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>func3</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Func</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>GetFunction2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>intValue</span> <span class=p>=</span> <span class=m>12</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;String created by GetFunction, value of {intValue}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Func</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>GetFunction3</span><span class=p>(</span><span class=kt>int</span> <span class=n>intValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;String created by GetFunction, value of {intValue}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Both of the methods, <em>GetFunction2</em> and <em>GetFunction3</em> return a <em>Func&lt;string></em> which makes use of the intValue variable.<br>When the <em>Func</em> is finally invoked, the variable <em>intValue</em> is no longer in scope of the Func (it was defined inside the scope of <em>GetFunction2</em> and <em>GetFunction3</em>, which are both now out of scope) - however the value is accessed and output correctly - this is <code>a closure</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-posh data-lang=posh><span class=line><span class=cl>    <span class=n>String</span> <span class=n>created</span> <span class=n>by</span> <span class=n>GetFunction</span><span class=p>,</span> <span class=n>value</span> <span class=n>of</span> <span class=n>12</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>created</span> <span class=n>by</span> <span class=n>GetFunction</span><span class=p>,</span> <span class=n>value</span> <span class=n>of</span> <span class=n>17</span></span></span></code></pre></td></tr></table></div></div><p>As mention in the intro, the <code>Closure</code> is <code>linked to the environment</code> in which it was declared, and as such has access to variables in that environment (intValue), even if outside of its direct scope.</p><hr><h2 id=how-it-works>How it works</h2><p>So what does the compiler do to make this work?<br>We can use <a class=link href=https://sharplab.io target=_blank rel=noopener>sharplab.io</a> to see exactly how this code is lowered:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3>3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4>4</a>
</span><span class=lnt id=ienumusage-5><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-5>5</a>
</span><span class=lnt id=ienumusage-6><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-6>6</a>
</span><span class=lnt id=ienumusage-7><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-7>7</a>
</span><span class=lnt id=ienumusage-8><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-8>8</a>
</span><span class=lnt id=ienumusage-9><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=kt>var</span> <span class=n>func2</span> <span class=p>=</span> <span class=n>GetFunction2</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>func2</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Func</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>GetFunction2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>intValue</span> <span class=p>=</span> <span class=m>12</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;String created by GetFunction, value of {intValue}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>The lowered code is as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1> 1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2> 2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3> 3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4> 4</a>
</span><span class=lnt id=ienumusage-5><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-5> 5</a>
</span><span class=lnt id=ienumusage-6><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-6> 6</a>
</span><span class=lnt id=ienumusage-7><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-7> 7</a>
</span><span class=lnt id=ienumusage-8><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-8> 8</a>
</span><span class=lnt id=ienumusage-9><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-9> 9</a>
</span><span class=lnt id=ienumusage-10><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-10>10</a>
</span><span class=lnt id=ienumusage-11><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-11>11</a>
</span><span class=lnt id=ienumusage-12><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-12>12</a>
</span><span class=lnt id=ienumusage-13><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-13>13</a>
</span><span class=lnt id=ienumusage-14><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-14>14</a>
</span><span class=lnt id=ienumusage-15><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-15>15</a>
</span><span class=lnt id=ienumusage-16><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-16>16</a>
</span><span class=lnt id=ienumusage-17><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-17>17</a>
</span><span class=lnt id=ienumusage-18><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-18>18</a>
</span><span class=lnt id=ienumusage-19><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-19>19</a>
</span><span class=lnt id=ienumusage-20><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-20>20</a>
</span><span class=lnt id=ienumusage-21><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-21>21</a>
</span><span class=lnt id=ienumusage-22><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-22>22</a>
</span><span class=lnt id=ienumusage-23><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-23>23</a>
</span><span class=lnt id=ienumusage-24><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-24>24</a>
</span><span class=lnt id=ienumusage-25><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-25>25</a>
</span><span class=lnt id=ienumusage-26><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-26>26</a>
</span><span class=lnt id=ienumusage-27><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-27>27</a>
</span><span class=lnt id=ienumusage-28><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-28>28</a>
</span><span class=lnt id=ienumusage-29><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-29>29</a>
</span><span class=lnt id=ienumusage-30><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-30>30</a>
</span><span class=lnt id=ienumusage-31><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=na>[assembly: CompilationRelaxations(8)]</span>
</span></span><span class=line><span class=cl><span class=na>[assembly: RuntimeCompatibility(WrapNonExceptionThrows = true)]</span>
</span></span><span class=line><span class=cl><span class=na>[assembly: Debuggable(DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints)]</span>
</span></span><span class=line><span class=cl><span class=na>[assembly: SecurityPermission(SecurityAction.RequestMinimum, SkipVerification = true)]</span>
</span></span><span class=line><span class=cl><span class=na>[assembly: AssemblyVersion(&#34;0.0.0.0&#34;)]</span>
</span></span><span class=line><span class=cl><span class=na>[module: UnverifiableCode]</span>
</span></span><span class=line><span class=cl><span class=na>[CompilerGenerated]</span>
</span></span><span class=line><span class=cl><span class=k>internal</span> <span class=k>static</span> <span class=k>class</span> <span class=p>&lt;</span><span class=n>Program</span><span class=p>&gt;</span><span class=err>$</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>sealed</span> <span class=k>class</span> <span class=p>&lt;&gt;</span><span class=n>c__DisplayClass0_0</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=kt>int</span> <span class=n>intValue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>internal</span> <span class=kt>string</span> <span class=p>&lt;&lt;</span><span class=n>Main</span><span class=p>&gt;</span><span class=err>$</span><span class=p>&gt;</span><span class=n>b__1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kt>string</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;String created by GetFunction, value of {0}&#34;</span><span class=p>,</span> <span class=n>intValue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=k>void</span> <span class=p>&lt;</span><span class=n>Main</span><span class=p>&gt;</span><span class=err>$</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(&lt;&lt;</span><span class=n>Main</span><span class=p>&gt;</span><span class=err>$</span><span class=p>&gt;</span><span class=n>g__GetFunction2</span><span class=p>|</span><span class=m>0_0</span><span class=p>()());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>internal</span> <span class=k>static</span> <span class=n>Func</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=p>&lt;&lt;</span><span class=n>Main</span><span class=p>&gt;</span><span class=err>$</span><span class=p>&gt;</span><span class=n>g__GetFunction2</span><span class=p>|</span><span class=m>0_0</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;&gt;</span><span class=n>c__DisplayClass0_0</span> <span class=p>&lt;&gt;</span><span class=n>c__DisplayClass0_</span> <span class=p>=</span> <span class=k>new</span> <span class=p>&lt;&gt;</span><span class=n>c__DisplayClass0_0</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;&gt;</span><span class=n>c__DisplayClass0_</span><span class=p>.</span><span class=n>intValue</span> <span class=p>=</span> <span class=m>12</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>Func</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;(&lt;&gt;</span><span class=n>c__DisplayClass0_</span><span class=p>.&lt;&lt;</span><span class=n>Main</span><span class=p>&gt;</span><span class=err>$</span><span class=p>&gt;</span><span class=n>b__1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Obviously this can get more complicated and complex depending on the use case, but essentially what the compiler is doing is as follows:</p><ul><li><strong>Lines 10-18</strong>: A &ldquo;dummy&rdquo; class (&lt;>c__DisplayClass0_0) is created which contains the variable required, and the <em>Func</em> is converted to a method on the class</li><li><strong>Lines 25-29</strong>: A method is created which instantiates the above class, sets the variable value and then invokes the method (which was the <em>Func</em>)</li><li><strong>Lines 22</strong>: The above method is invoked, creating the class, setting the value and outputting the result</li></ul><hr><h2 id=variable-not-value>Variable not value</h2><p>One final example, show that the <code>closure uses the variable, not the value</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3>3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=kt>int</span> <span class=n>localInt</span> <span class=p>=</span> <span class=m>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Func</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>localFunc</span> <span class=p>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;The value of localInt is: {localInt}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>localInt</span> <span class=p>=</span> <span class=m>150</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>localFunc</span><span class=p>());</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>Lines 2</strong>: A <em>Func</em> is defined, which outputs the value of <em>localInt</em>. At the time the function is created, the <code>localInt value is 100</code></li><li><strong>Lines 3</strong>: <em>localInt</em> value is increased to 150</li><li><strong>Lines 4</strong>: The <em>Func</em> is invoked, with the <code>localInt value at 150</code></li></ul><p>The output:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl>    <span class=n>The</span> <span class=k>value</span> <span class=n>of</span> <span class=n>x</span> <span class=k>is</span><span class=p>:</span> <span class=m>150</span></span></span></code></pre></td></tr></table></div></div><p>As mentioned, the closure uses the variable (which can change value) and not the value when it was created.</p><hr><h2 id=notes>Notes</h2><p><code>Closures</code> are easy to use and implement, but this is enabled by the compiler doing lots of work behind the scenes. They are another useful tool to be aware of when coding and thinking through how the code might fit together.</p><hr><h2 id=references>References</h2><p><a class=link href=https://www.simplethread.com/c-closures-explained/ target=_blank rel=noopener>A Simple Explanation of C# Closures</a><br><a class=link href=https://www.infoworld.com/article/3620248/how-to-use-closures-in-csharp.html target=_blank rel=noopener>How to use closures in C#</a></p><blockquote><div><div style=width:5%;float:left;vertical-align:middle;padding-right:60px><i class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-bulb" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffbf00" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7"/><path d="M9 16a5 5 0 116 0 3.5 3.5.0 00-1 3 2 2 0 01-4 0 3.5 3.5.0 00-1-3"/><line x1="9.7" y1="17" x2="14.3" y2="17"/></svg></i></div><div><h3>Daily Drop 32: 16-03-2022</h3></div><br><div>At the start of 2022 I set myself the goal of learning one new coding related piece of knowledge a day.<br>It could be anything - some .NET/C# functionality I wasn't aware of, a design practice, a cool new coding technique, or just something I find interesting. It could be something I knew at one point but had forgotten, or something completely new, which I may or may never actually use.<br><br>The Daily Drop is a record of these pieces of knowledge - writing about and summarizing them helps re-enforce the information for myself, as well as potentially helps others learn something new as well.</div></div></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/c#/>c#</a>
<a href=/tags/.net/>.net</a>
<a href=/tags/dailydrop/>dailydrop</a>
<a href=/tags/closure/>closure</a>
<a href=/tags/method/>method</a>
<a href=/tags/function/>function</a></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/dailydrop/2022/03/15-private-underscore/><div class=article-details><h2 class=article-title>Private variables prefixed with underscore?</h2></div></a></article><article><a href=/dailydrop/2022/03/14-enum-isdefined/><div class=article-details><h2 class=article-title>Enum validity with IsDefined</h2></div></a></article><article><a href=/dailydrop/2022/03/11-switch-multi-case/><div class=article-details><h2 class=article-title>Evolution of multi case switch statements</h2></div></a></article><article><a href=/dailydrop/2022/03/10-duck-typing/><div class=article-details><h2 class=article-title>Duck typing in C#</h2></div></a></article><article><a href=/dailydrop/2022/03/09-lazy-class/><div class=article-details><h2 class=article-title>Lazy loading objects with Lazy&lt;></h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=always-developing/always-developing.github.io data-repo-id=R_kgDOGQJLBQ data-category=Comments data-category-id=DIC_kwDOGQJLBc4B_pUA data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-theme=light crossorigin=anonymous async></script>
<script>function setGiscusTheme(t){let e=document.querySelector("iframe.giscus-frame");e&&e.contentWindow.postMessage({giscus:{setConfig:{theme:t}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){document.documentElement.dataset.scheme==="light"?setGiscusTheme("light"):setGiscusTheme("dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2021 -
2022 Always Developing</section><section class=powerby>Always Developing | always learning | always growing<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#daily-knowledge-drop>Daily Knowledge Drop</a></li><li><a href=#first-class-function>First class function</a></li><li><a href=#variables-outside-scope>Variables outside scope</a></li><li><a href=#how-it-works>How it works</a></li><li><a href=#variable-not-value>Variable not value</a></li><li><a href=#notes>Notes</a></li><li><a href=#references>References</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>