<!doctype html><html lang=en-uk><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How to emit source generated files to be included in source control"><title>Customize source generator output location</title><link rel=canonical href=https://always-developing.github.io/dailydrop/2022/02/22-emit-source-generator-files/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Customize source generator output location"><meta property="og:description" content="How to emit source generated files to be included in source control"><meta property="og:url" content="https://always-developing.github.io/dailydrop/2022/02/22-emit-source-generator-files/"><meta property="og:site_name" content="Always Developing"><meta property="og:type" content="article"><meta property="article:section" content="Dailydrop"><meta property="article:tag" content="c#"><meta property="article:tag" content=".net"><meta property="article:tag" content="dailydrop"><meta property="article:tag" content="roslyn"><meta property="article:tag" content="sourcegenerator"><meta property="article:tag" content="generator"><meta property="article:published_time" content="2022-02-22T01:00:00+02:00"><meta property="article:modified_time" content="2022-02-22T01:00:00+02:00"><meta name=twitter:title content="Customize source generator output location"><meta name=twitter:description content="How to emit source generated files to be included in source control"><link rel="shortcut icon" href=favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-CXPLFS7K38"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CXPLFS7K38",{anonymize_ip:!1})}</script></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"dark")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://always-developing.github.io/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/dailydrop/>DailyDrop</a></header><h2 class=article-title><a href=/dailydrop/2022/02/22-emit-source-generator-files/>Customize source generator output location</a></h2><h3 class=article-subtitle>How to emit source generated files to be included in source control</h3><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Feb 22, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>7 minute read</time></div></footer></div></header><section class=article-content><h2 id=daily-knowledge-drop>Daily Knowledge Drop</h2><p>The output location of code created by a <code>Roslyn source generator</code> can be customized, so that the output file can be included in source control (to be included in code reviews for example).</p><p>This post will give a brief overview of source generators, and then show the default behavior and how it can be customized.</p><p>This post will not go into detail regarding the finer details of source generators - if you would like more details on source generators, see the reference links below.</p><hr><h2 id=source-generators>Source generators</h2><p>In short, a source generator is a piece of <code>code which writes code</code>. The functionality ships as part of <em>Roslyn</em>, the .NET Compiler Platform SDK.</p><p>Source generators allow for the inspection of user code as <em>compile time</em>, and then based on specific criteria, can add additional code to the original code base, on the fly.</p><p>Let&rsquo;s look at a very simple example, and all it&rsquo;s moving parts. In the example, <code>based on an attribute being present on a class, an additional method called "WhoAmI" will be added to the class, which will return the class the method is a member of</code>.</p><p>This code is very basic and by no means production ready.</p><hr><h3 id=define-the-qualifier>Define the qualifier</h3><p>For a class to qualify for the new <em>WhoAmI</em> method, it will need to be decorated with an attribute - so first the attribute is defined. This is not specific to source generators, just a normal C#attribute.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3>3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4>4</a>
</span><span class=lnt id=ienumusage-5><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=na>[AttributeUsage(AttributeTargets.Class)]</span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>WhoAmIAttribute</span> <span class=p>:</span> <span class=n>Attribute</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=n>WhoAmIAttribute</span><span class=p>()</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><hr><h3 id=find-qualifying-classes>Find qualifying classes</h3><p>The next step is to setup the rule to find qualifying classes. This is done using an <em>ISyntaxReceiver</em> implementation. Roslyn will parse the entire code base and for each separate syntax node (each part of code) will call the <em>ISyntaxReceiver</em> implementation.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1> 1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2> 2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3> 3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4> 4</a>
</span><span class=lnt id=ienumusage-5><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-5> 5</a>
</span><span class=lnt id=ienumusage-6><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-6> 6</a>
</span><span class=lnt id=ienumusage-7><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-7> 7</a>
</span><span class=lnt id=ienumusage-8><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-8> 8</a>
</span><span class=lnt id=ienumusage-9><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-9> 9</a>
</span><span class=lnt id=ienumusage-10><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-10>10</a>
</span><span class=lnt id=ienumusage-11><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-11>11</a>
</span><span class=lnt id=ienumusage-12><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-12>12</a>
</span><span class=lnt id=ienumusage-13><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-13>13</a>
</span><span class=lnt id=ienumusage-14><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-14>14</a>
</span><span class=lnt id=ienumusage-15><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-15>15</a>
</span><span class=lnt id=ienumusage-16><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-16>16</a>
</span><span class=lnt id=ienumusage-17><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-17>17</a>
</span><span class=lnt id=ienumusage-18><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-18>18</a>
</span><span class=lnt id=ienumusage-19><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-19>19</a>
</span><span class=lnt id=ienumusage-20><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-20>20</a>
</span><span class=lnt id=ienumusage-21><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>WhoAmISyntaxReceiver</span> <span class=p>:</span> <span class=n>ISyntaxReceiver</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// This is to store the class which qualified</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=n>ClassDeclarationSyntax</span> <span class=n>QualifyingClass</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>private</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>void</span> <span class=n>OnVisitSyntaxNode</span><span class=p>(</span><span class=n>SyntaxNode</span> <span class=n>syntaxNode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// if the node is a class declaration</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>syntaxNode</span> <span class=k>is</span> <span class=n>ClassDeclarationSyntax</span> <span class=n>cds</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// check if the class is decorated </span>
</span></span><span class=line><span class=cl>            <span class=c1>// with an attribute called &#34;WhoAmI&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>cds</span><span class=p>.</span><span class=n>AttributeLists</span><span class=p>.</span><span class=n>SelectMany</span><span class=p>(</span><span class=n>al</span> <span class=p>=&gt;</span> 
</span></span><span class=line><span class=cl>                    <span class=n>al</span><span class=p>.</span><span class=n>Attributes</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>a</span> <span class=p>=&gt;</span> 
</span></span><span class=line><span class=cl>                        <span class=n>a</span><span class=p>.</span><span class=n>Name</span><span class=p>.</span><span class=n>ToString</span><span class=p>().</span><span class=n>Equals</span><span class=p>(</span><span class=s>&#34;WhoAmI&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                            <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>)).</span><span class=n>Any</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>QualifyingClass</span> <span class=p>=</span> <span class=n>cds</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>Line 9</strong>: The type of the node is checked, and if its not a <em>ClassDeclaration</em> we can ignore as it will automatically not qualify</li><li><strong>Line 13-17</strong>: Check if there are any attributes decorating the class and which are called &ldquo;WhoAmI&rdquo;</li><li><strong>Line 18</strong>: Store the ClassDeclarationSyntax details of the class which qualified</li></ul><p><strong>This implementation, as well as the generator are created in a separate project called <em>WhoAmI.Generator</em>.</strong></p><hr><h3 id=generate-the-code>Generate the code</h3><p>Next, is to setup the actual generator. The generator will received input from the <em>ISyntaxReceiver</em> implementation, generate the code as a string, and then output a C# file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1> 1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2> 2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3> 3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4> 4</a>
</span><span class=lnt id=ienumusage-5><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-5> 5</a>
</span><span class=lnt id=ienumusage-6><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-6> 6</a>
</span><span class=lnt id=ienumusage-7><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-7> 7</a>
</span><span class=lnt id=ienumusage-8><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-8> 8</a>
</span><span class=lnt id=ienumusage-9><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-9> 9</a>
</span><span class=lnt id=ienumusage-10><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-10>10</a>
</span><span class=lnt id=ienumusage-11><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-11>11</a>
</span><span class=lnt id=ienumusage-12><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-12>12</a>
</span><span class=lnt id=ienumusage-13><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-13>13</a>
</span><span class=lnt id=ienumusage-14><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-14>14</a>
</span><span class=lnt id=ienumusage-15><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-15>15</a>
</span><span class=lnt id=ienumusage-16><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-16>16</a>
</span><span class=lnt id=ienumusage-17><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-17>17</a>
</span><span class=lnt id=ienumusage-18><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-18>18</a>
</span><span class=lnt id=ienumusage-19><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-19>19</a>
</span><span class=lnt id=ienumusage-20><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-20>20</a>
</span><span class=lnt id=ienumusage-21><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-21>21</a>
</span><span class=lnt id=ienumusage-22><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-22>22</a>
</span><span class=lnt id=ienumusage-23><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-23>23</a>
</span><span class=lnt id=ienumusage-24><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-24>24</a>
</span><span class=lnt id=ienumusage-25><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-25>25</a>
</span><span class=lnt id=ienumusage-26><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-26>26</a>
</span><span class=lnt id=ienumusage-27><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-27>27</a>
</span><span class=lnt id=ienumusage-28><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-28>28</a>
</span><span class=lnt id=ienumusage-29><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-29>29</a>
</span><span class=lnt id=ienumusage-30><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-30>30</a>
</span><span class=lnt id=ienumusage-31><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-31>31</a>
</span><span class=lnt id=ienumusage-32><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-32>32</a>
</span><span class=lnt id=ienumusage-33><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-33>33</a>
</span><span class=lnt id=ienumusage-34><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-34>34</a>
</span><span class=lnt id=ienumusage-35><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-35>35</a>
</span><span class=lnt id=ienumusage-36><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=na>[Generator]</span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>WhoAmIGenerator</span> <span class=p>:</span> <span class=n>ISourceGenerator</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>(</span><span class=n>GeneratorExecutionContext</span> <span class=n>context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>WhoAmISyntaxReceiver</span> <span class=n>syntaxReceiver</span> <span class=p>=</span> 
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=n>WhoAmISyntaxReceiver</span><span class=p>)</span><span class=n>context</span><span class=p>.</span><span class=n>SyntaxReceiver</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// just double check the type is not null</span>
</span></span><span class=line><span class=cl>        <span class=n>ClassDeclarationSyntax</span> <span class=n>qualifyingClass</span> <span class=p>=</span> <span class=n>syntaxReceiver</span><span class=p>.</span><span class=n>QualifyingClass</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>qualifyingClass</span> <span class=k>is</span> <span class=k>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// add the generated implementation to the compilation</span>
</span></span><span class=line><span class=cl>        <span class=n>SourceText</span> <span class=n>sourceText</span> <span class=p>=</span> <span class=n>SourceText</span><span class=p>.</span><span class=n>From</span><span class=p>(</span><span class=s>$@&#34;
</span></span></span><span class=line><span class=cl><span class=s>namespace EmitGenerated;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>public partial class {qualifyingClass.Identifier}
</span></span></span><span class=line><span class=cl><span class=s>{{
</span></span></span><span class=line><span class=cl><span class=s>    public string WhoAmI()
</span></span></span><span class=line><span class=cl><span class=s>    {{
</span></span></span><span class=line><span class=cl><span class=s>        return this.GetType().Name;
</span></span></span><span class=line><span class=cl><span class=s>    }}
</span></span></span><span class=line><span class=cl><span class=s>}}&#34;</span><span class=p>,</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=p>.</span><span class=n>AddSource</span><span class=p>(</span><span class=s>$&#34;{qualifyingClass.Identifier}.Generated.cs&#34;</span><span class=p>,</span> <span class=n>sourceText</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>void</span> <span class=n>Initialize</span><span class=p>(</span><span class=n>GeneratorInitializationContext</span> <span class=n>context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// register the generator to receive notification from WhoAmISyntaxReceiver</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=p>.</span><span class=n>RegisterForSyntaxNotifications</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=n>WhoAmISyntaxReceiver</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>Line 10</strong>: Get the qualifying class from the receiver</li><li><strong>Line 17-26</strong>: Generate the required code as a string</li><li><strong>Line 28</strong>: Output the C# file with the given name and code</li><li><strong>Line 34</strong>: Register the receiver with the generator</li></ul><p><strong>This implementation, as well as the receiver mentioned above, are created in a separate project called <em>WhoAmI.Generator</em>.</strong></p><hr><h3 id=project-reference>Project Reference</h3><p>Now we have to register the generator in the main project. The <em>WhoAmI.Generator</em> project (which contains the generator and the receiver) can be referenced as a normal <em>Project Reference</em> initially. However, the csproj then needs to be edited to indicate that the referenced project is a generator and not a normal project reference.</p><p>The <em>OutputItemType</em> and <em>ReferenceOutputAssembly</em> values are added. The relevant section in the csproj file will look as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3>3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;ItemGroup&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;ProjectReference</span> <span class=na>Include=</span><span class=s>&#34;..\WhoAmI.Generator\WhoAmI.Generator.csproj&#34;</span> 
</span></span><span class=line><span class=cl>        <span class=na>OutputItemType=</span><span class=s>&#34;Analyzer&#34;</span> <span class=na>ReferenceOutputAssembly=</span><span class=s>&#34;false&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/ItemGroup&gt;</span></span></span></code></pre></td></tr></table></div></div><hr><h3 id=implement-and-output>Implement and output</h3><p>Finally, it&rsquo;s time to use the generator.</p><p>A partial class is created, and decorated with the attribute:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=na>[WhoAmI]</span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>partial</span> <span class=k>class</span> <span class=nc>RandomClass</span> <span class=p>{</span> <span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Even though the class doesn&rsquo;t directly contain a method called <em>WhoAmI</em>, the generator will create the method in a separate file (which is allowed as the class is partial):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=kt>var</span> <span class=n>rc</span> <span class=p>=</span> <span class=k>new</span> <span class=n>RandomClass</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>rc</span><span class=p>.</span><span class=n>WhoAmI</span><span class=p>());</span></span></span></code></pre></td></tr></table></div></div><p>The output:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-posh data-lang=posh><span class=line><span class=cl>    <span class=n>RandomClass</span></span></span></code></pre></td></tr></table></div></div><p>We are now able to call the <em>WhoAmI</em> method to find out the type.</p><h3 id=limitations>Limitations</h3><p>The advantage of generators is that the code is automatically generated at <em>compile time</em>, however the side-effect of this is that the code is not emitted to a file on disk. The only way to see the code generated it to browse to the file under <em>Dependencies => Analyzers</em>.</p><p><figure class=gallery-image style=flex-grow:325;flex-basis:780px><a href=/dailydrop/2022/02/22-emit-source-generator-files/1.source-output.png data-size=761x234><img src=/dailydrop/2022/02/22-emit-source-generator-files/1.source-output.png width=761 height=234 srcset="/dailydrop/2022/02/22-emit-source-generator-files/1.source-output_hu61b356e2225364a468b6303342304c36_95814_480x0_resize_box_3.png 480w, /dailydrop/2022/02/22-emit-source-generator-files/1.source-output_hu61b356e2225364a468b6303342304c36_95814_1024x0_resize_box_3.png 1024w" loading=lazy alt="Generated output"></a><figcaption>Generated output</figcaption></figure></p><p>Up until now this process has worked and might suite your needs just fine. But if you need the <code>generated file(s) to be code reviewed and committed to source control</code>, the current setup will not allow that.</p><p>Next we&rsquo;ll look at how the process can be configured to emit the file.</p><hr><h2 id=customization>Customization</h2><h2 id=emit-the-file>Emit the file</h2><p>First, lets configure that the file should be emitted. This is done by adding an <code>EmitCompilerGeneratedFiles</code> node to the csproj file of the application.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;EmitCompilerGeneratedFiles&gt;</span>true<span class=nt>&lt;/EmitCompilerGeneratedFiles&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/PropertyGroup&gt;</span></span></span></code></pre></td></tr></table></div></div><p>The file is now generated in the following location:<br><code>{BaseIntermediateOutpath}/generated/{Assembly}/{SourceGeneratorName}/{GeneratedFile}</code></p><p>Typically this could be the obj folder:</p><p><figure class=gallery-image style=flex-grow:689;flex-basis:1654px><a href=/dailydrop/2022/02/22-emit-source-generator-files/2.emit-output.png data-size=765x111><img src=/dailydrop/2022/02/22-emit-source-generator-files/2.emit-output.png width=765 height=111 srcset="/dailydrop/2022/02/22-emit-source-generator-files/2.emit-output_hu23d0b89292b104d34d57db0e441ad5be_6823_480x0_resize_box_3.png 480w, /dailydrop/2022/02/22-emit-source-generator-files/2.emit-output_hu23d0b89292b104d34d57db0e441ad5be_6823_1024x0_resize_box_3.png 1024w" loading=lazy alt="Default emit output"></a><figcaption>Default emit output</figcaption></figure></p><hr><h3 id=change-the-location>Change the location</h3><p>The <code>CompilerGeneratedFilesOutputPath</code> node can be added to control where file should be emitted to:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3>3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;EmitCompilerGeneratedFiles&gt;</span>true<span class=nt>&lt;/EmitCompilerGeneratedFiles&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;CompilerGeneratedFilesOutputPath&gt;</span>SourceGenerated<span class=nt>&lt;/CompilerGeneratedFilesOutputPath&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/PropertyGroup&gt;</span></span></span></code></pre></td></tr></table></div></div><p>The file is now generated in the following location:<br><code>{CompilerGeneratedFilesOutputPath}/{Assembly}/{SourceGeneratorName}/{GeneratedFile}</code></p><p><figure class=gallery-image style=flex-grow:587;flex-basis:1408px><a href=/dailydrop/2022/02/22-emit-source-generator-files/3.custom-ouput.png data-size=681x116><img src=/dailydrop/2022/02/22-emit-source-generator-files/3.custom-ouput.png width=681 height=116 srcset="/dailydrop/2022/02/22-emit-source-generator-files/3.custom-ouput_huc59396d3b3c05c350f13f18c151f6f3c_6638_480x0_resize_box_3.png 480w, /dailydrop/2022/02/22-emit-source-generator-files/3.custom-ouput_huc59396d3b3c05c350f13f18c151f6f3c_6638_1024x0_resize_box_3.png 1024w" loading=lazy alt="Custom emit output"></a><figcaption>Custom emit output</figcaption></figure></p><hr><h3 id=fix-errors>Fix errors</h3><p>As it stands now, the application won&rsquo;t compile due to the following error:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-posh data-lang=posh><span class=line><span class=cl>    <span class=nb>Type </span><span class=s1>&#39;RandomClass&#39;</span> <span class=n>already</span> <span class=n>defines</span> <span class=n>a</span> <span class=n>member</span> <span class=n>called</span> <span class=s1>&#39;WhoAmI&#39;</span> <span class=n>with</span> <span class=n>the</span> <span class=n>same</span> <span class=k>parameter</span> <span class=n>types</span></span></span></code></pre></td></tr></table></div></div><p>We have configured the file to be emitted to the custom location, however the file is <em><strong>still also being emitted into memory and compiled as part of the source</strong></em>.<br>Knowing this, the above error now makes sense - we have two files used in compilation, generating the same method.</p><p>The final step is to exclude the files emitted to disk from being used in the compilation. An <em>ItemGroup</em> is added to the csproj file, which instructions any cs files emitted to disk by the source generator to be excluded from compilation.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1>1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2>2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3>3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4>4</a>
</span><span class=lnt id=ienumusage-5><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-5>5</a>
</span><span class=lnt id=ienumusage-6><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-6>6</a>
</span><span class=lnt id=ienumusage-7><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-7>7</a>
</span><span class=lnt id=ienumusage-8><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;EmitCompilerGeneratedFiles&gt;</span>true<span class=nt>&lt;/EmitCompilerGeneratedFiles&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;CompilerGeneratedFilesOutputPath&gt;</span>SourceGenerated<span class=nt>&lt;/CompilerGeneratedFilesOutputPath&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;ItemGroup&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;Compile</span> <span class=na>Remove=</span><span class=s>&#34;$(CompilerGeneratedFilesOutputPath)/**/*.cs&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/ItemGroup&gt;</span></span></span></code></pre></td></tr></table></div></div><p>The files will still be emitted to disk, and so can be included in source control and code reviews, but are now marked to be excluded in the compilation process.</p><hr><h2 id=notes>Notes</h2><p>Source generators are a powerful tool to be leveraged to solve certain use cases - however the tooling to support them is not always as powerful. The ability to emit the files to disk can be used to assist with the development inner look to ensure the output code is correct, as well as included as part of source control to be properly reviewed.</p><hr><h2 id=references>References</h2><p><a class=link href=https://docs.microsoft.com/en-us/dotnet/csharp/roslyn-sdk/source-generators-overview target=_blank rel=noopener>Source Generators</a><br><a class=link href=https://andrewlock.net/creating-a-source-generator-part-6-saving-source-generator-output-in-source-control/ target=_blank rel=noopener>Saving source generator output in source control</a></p><blockquote><div><div style=width:5%;float:left;vertical-align:middle;padding-right:60px><i class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-bulb" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffbf00" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7"/><path d="M9 16a5 5 0 116 0 3.5 3.5.0 00-1 3 2 2 0 01-4 0 3.5 3.5.0 00-1-3"/><line x1="9.7" y1="17" x2="14.3" y2="17"/></svg></i></div><div><h3>Daily Drop 16: 22-02-2022</h3></div><br><div>At the start of 2022 I set myself the goal of learning one new coding related piece of knowledge a day.<br>It could be anything - some .NET/C# functionality I wasn't aware of, a design practice, a cool new coding technique, or just something I find interesting. It could be something I knew at one point but had forgotten, or something completely new, which I may or may never actually use.<br><br>The Daily Drop is a record of these pieces of knowledge - writing about and summarizing them helps re-enforce the information for myself, as well as potentially helps others learn something new as well.</div></div></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/c#/>c#</a>
<a href=/tags/.net/>.net</a>
<a href=/tags/dailydrop/>dailydrop</a>
<a href=/tags/roslyn/>roslyn</a>
<a href=/tags/sourcegenerator/>sourceGenerator</a>
<a href=/tags/generator/>generator</a></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/dailydrop/2022/02/21-ef-core6-entitytypeconfig/><div class=article-details><h2 class=article-title>EF Core 6 EntityTypeConfiguration Attribute</h2></div></a></article><article><a href=/dailydrop/2022/02/18-gc-variables/><div class=article-details><h2 class=article-title>Garbage collection configuration</h2></div></a></article><article><a href=/dailydrop/2022/02/17-using-idisposable/><div class=article-details><h2 class=article-title>Using with IDisposable</h2></div></a></article><article><a href=/dailydrop/2022/02/16-task-wait-async/><div class=article-details><h2 class=article-title>Task.WaitAsync in .NET6</h2></div></a></article><article><a href=/dailydrop/2022/02/15-global-using-directives/><div class=article-details><h2 class=article-title>Aliases with global using directives</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=always-developing/always-developing.github.io data-repo-id=R_kgDOGQJLBQ data-category=Comments data-category-id=DIC_kwDOGQJLBc4B_pUA data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-theme=light crossorigin=anonymous async></script>
<script>function setGiscusTheme(t){let e=document.querySelector("iframe.giscus-frame");e&&e.contentWindow.postMessage({giscus:{setConfig:{theme:t}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){document.documentElement.dataset.scheme==="light"?setGiscusTheme("light"):setGiscusTheme("dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2021 -
2022 Always Developing</section><section class=powerby>Always Developing | always learning | always growing<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#daily-knowledge-drop>Daily Knowledge Drop</a></li><li><a href=#source-generators>Source generators</a><ol><li><a href=#define-the-qualifier>Define the qualifier</a></li><li><a href=#find-qualifying-classes>Find qualifying classes</a></li><li><a href=#generate-the-code>Generate the code</a></li><li><a href=#project-reference>Project Reference</a></li><li><a href=#implement-and-output>Implement and output</a></li><li><a href=#limitations>Limitations</a></li></ol></li><li><a href=#customization>Customization</a></li><li><a href=#emit-the-file>Emit the file</a><ol><li><a href=#change-the-location>Change the location</a></li><li><a href=#fix-errors>Fix errors</a></li></ol></li><li><a href=#notes>Notes</a></li><li><a href=#references>References</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>