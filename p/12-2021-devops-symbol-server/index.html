<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="always learning | always growing">

    <title>Always Developing - Azure Devops Symbol Server - a how to guide</title>

    <link rel="canonical" href="https://alwaysdeveloping.net/p/12-2021-devops-symbol-server">

            <link type="application/rss+xml" rel="alternate" href="/feed.rss" />
            <link type="application/atom+xml" rel="alternate" href="/feed.atom" />

    <meta name="application-name" content="Always Developing" />
    <meta name="msapplication-tooltip" content="Always Developing" />
    <meta name="msapplication-starturl" content="/" />

    <meta property="og:title" content="Always Developing - Azure Devops Symbol Server - a how to guide" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://alwaysdeveloping.net/p/12-2021-devops-symbol-server" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- Bootstrap core CSS -->
    <link href="/vendor/bootstrap/scss/bootstrap.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="/vendor/fontawesome-free/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css' data-no-mirror>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css' data-no-mirror>

    <!-- Custom styles for this template -->
    <link href="/scss/always-developing-blog.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
    <script src="https://cdn.jsdelivr.net/npm/quicklink@2.0.0/dist/quicklink.umd.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/themes/prism.css">

    <!-- Lunr search -->
        <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/pako@2.0.3/dist/pako_inflate.min.js"></script>
        <script src="/search.js"></script>

    


    

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
        <a class="navbar-brand"  href="/">
            <img src="/images/ad_logo.png" alt="" width="25" height="25" class="d-inline-block align-text-top">
            Always Developing
        </a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            Menu
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="/software">Software</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/posts">Posts</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/tags">Tags</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
            </li>
</ul>
                <form class="form-inline my-2 my-lg-0" action="/search" method="GET">
                    <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="query">
                    <input type="submit" hidden />
                </form>
        </div>
    </div>
</nav>

    <!-- Page Header -->
    <header class="masthead">
    <div class="container">
        <div class="row">
            <div class="col-md-2 align-middle">
                <div class="post-header-image">
                    <a href="/">
                        <img src="/images/ad_logo.png" class="header-image">
                    </a>
                </div>
            </div>
            <div class="col-md-10">
                <div class="post-heading">
                    <h1>
                        Azure Devops Symbol Server - a how to guide
                    </h1>
                            <h2 class="subheading">A guide to using an Azure Devops Symbol Server</h2>
                        <p class="post-meta">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar2-week" viewBox="0 0 16 16">
                                <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z" />
                                <path d="M2.5 4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V4zM11 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-5 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z" />
                            </svg> Published on Tuesday, 04 January 2022
                        </p>
                </div>
            </div>
        </div>
    </div>
</header>

    <!-- Main Content -->
    <div class="container">
            <div class="row ">
                    <div id="content" class="col-md-9 post-with-toc post-block">
                        
<div class="post-header-category">
    <a class="btn btn-primary btn-sm btn-default btn-home" href="\" role="button"><i class="fas fa-angle-double-left"></i> Home</a>
            <a class="btn btn-primary btn-sm category-btn" href="/categories/blog" role="button">Blog</a>
</div>

                        <h2 id="symbol-server-explained">Symbol server explained</h2>
<h3 id="what-are-symbols">What are symbols?</h3>
<p>When building a .NET project, symbol files (generally files with the extension of .pdb) are automatically created by the compiler. These symbol files contain metadata information about the source code (indexes, function names, line numbers, etc) and are used when debugging and stepping through code, by linking the debugger (e.g. Visual Studio) to the source code.</p>
<p>Generally, these symbol files are only available when developing locally, and building a project in debug configuration - that is, unless they are uploaded to a <code>symbol server</code>.</p>
<h3 id="what-is-a-symbol-server">What is a symbol server?</h3>
<p><strong>A symbol server is a central location to store symbols</strong> - having the symbols available allow for the <code>stepping into a referenced NuGet package code</code> without having the source code available locally.<br />
The source code doesn't need to be part of the solution being built, or even on the local machine - the symbol file, made available by the symbol server will allow for full <em>'step into'</em> debugging experience.</p>
<hr />
<h2 id="why-use-a-symbol-server">Why use a symbol server</h2>
<p>As mentioned above, having the symbols available via the server, allows for stepping into a referenced package's source code without having the source directly available locally. Why would one need or want this to be possible?</p>
<ul>
<li><code>Help the package author debug and assist when issues are experienced using the package</code>. This is especially useful in the corporate environment where the author of a package is potentially closer to the developers and applications using the package, and is required to assist with the usage and functioning of the package.</li>
<li><code>Help users of the package understand in more depth what the package does and how</code>. Especially useful in an Open Source environment where the author of the package is most likely further removed from the user of the package. With the user of the package having the option of stepping into the package source code, it facilitates more easily understanding the package and allows for the user more easily <em>help themselves</em> if any issues arise.</li>
</ul>
<p>Even though each point above highlights the use case in a specific environment (corporate vs Open Source), both points can apply to either environment.</p>

<blockquote class="info-block">
    <div>
        <div style="width: 5%; float: left; vertical-align: middle; padding-right: 60px; ">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-info-circle" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#00abfb" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <circle cx="12" cy="12" r="9" />
                <line x1="12" y1="8" x2="12.01" y2="8" />
                <polyline points="11 12 12 12 12 16 13 16" />
            </svg >
        </div >
        <div>
            <p>
<p>This post will focus on using <strong>Azure Devops</strong> as a build and symbol server, but other build and symbol servers can also be used and will <em>mostly</em> follow a similar processes to the one described in this post.</p>
</p>
        </div>
    </div>
</blockquote >

<hr />
<h2 id="producing-symbols">Producing symbols</h2>
<h3 id="configuring-code">Configuring code</h3>
<p>The first step in the process, is to configure the project to produce symbols with the required metadata to allow for the debugging experience.<br />
To do this, the required <code>Source Link</code> NuGet package must be added to the project. There are <a href="https://www.nuget.org/packages?q=Microsoft.SourceLink.">a number of different options available</a>, based on where the <code>repository is hosted</code>.</p>
<p>For a repository hosted in a Git repository in Azure Devops, a reference to <code>Microsoft.SourceLink.AzureRepos.Git</code> is added.</p>
<pre><code class="language-xml">&lt;PackageReference Include=&quot;Microsoft.SourceLink.AzureRepos.Git&quot; Version=&quot;1.1.1&quot;&gt;
    &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;
    &lt;IncludeAssets&gt;runtime; build; native; contentfiles; analyzers; buildtransitive&lt;/IncludeAssets&gt;
&lt;/PackageReference&gt;
</code></pre>

<blockquote class="info-block">
    <div>
        <div style="width: 5%; float: left; vertical-align: middle; padding-right: 60px; ">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-info-circle" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#00abfb" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <circle cx="12" cy="12" r="9" />
                <line x1="12" y1="8" x2="12.01" y2="8" />
                <polyline points="11 12 12 12 12 16 13 16" />
            </svg >
        </div >
        <div>
            <p>
<p>The Source Link reference added is <strong>required only as a development dependency</strong> and is only used during the build process. This is the reason the <code>PrivateAssets</code> property is set to <code>All</code> - this prevents the package consuming applications from also needing to install Source Link as a dependency.</p>
</p>
        </div>
    </div>
</blockquote >

<hr />
<h3 id="configuring-cicd-pipeline">Configuring CI/CD pipeline</h3>
<p>The next step is to have the CI/CD process produce the symbols, and then upload them to the symbol server.</p>
<ol>
<li><p><code>Producing the symbols</code><br />
Usually when developing locally, .pdb files are only generated when running in <em>debug configuration</em>, when the code is un-optimized. However, When releasing a package, it should be built in <em>release configuration</em> with optimized code.<br />
With the relevant Source Link package reference added (Microsoft.SourceLink.AzureRepos.Git), the code can be built in <em>release configuration</em> and have the symbols produced. The build can either be done using:</p>
<ul>
<li><code>dotnet build</code>:<br />
Execute the <strong>dotnet build</strong> command with a build configuration of Release
<img src="1.dotnettask.png" alt="Azure Devops dotnet task" /><br />
<img src="2.dotnetdetail.png" alt="Azure Devops dotnet task detail" /></li>
<li><code>Visual Studio build</code>:<br />
Execute the <strong>Visual Studio build</strong> task with build configuration of Release, and with the <em>MSBuild Argument</em> of <code>/p:SourceLinkCreate=true</code>
<img src="3.vsbuildtask.png" alt="Azure Devops VS build task" /><br />
<img src="4.vsbuilddetail.png" alt="Azure Devops VS build task detail" /></li>
</ul>
</li>
<li><p><code>Publishing the symbols</code>:<br />
The <strong>Index sources and publish symbols</strong> task is then used to publish the symbols to either a <em>file share</em>, or the <em>Azure Devops symbol server</em>
<img src="5.symboltask.png" alt="Azure Devops publish symbol task" /><br />
<img src="6.symboldetail.png" alt="Azure Devops publish symbol detail" /></p>
<p>Generally the publishing of artifacts would be part of the release pipeline, and not the build. However the <strong>Index sources and publish symbols</strong> task is <code>only available in the build pipeline</code>.</p>
</li>
</ol>
<hr />
<h2 id="consuming-symbols">Consuming symbols</h2>
<h3 id="configuring-visual-studio">Configuring Visual Studio</h3>
<p>The final step is to configure Visual Studio with the details on how and when to download and use the symbols. Perform the following steps in Visual Studio.</p>
<ol>
<li>Configure the symbol server location:
<ol>
<li>Navigate to <code>Tools -&gt; Options -&gt; Debugging -&gt; Symbols</code></li>
<li>Click <code>New Azure Devops Symbol Server Location</code></li>
<li>Select the account, and a list of symbol servers available to the account will be displayed. Chose the server. (in the screen shot below, none are shown as the <em>always-developing</em> Github account is not linked to Azure Devops)</li>
<li>Click <code>Connect</code></li>
</ol>
</li>
</ol>
<p><img src="7.SymbolServerAdd.png" alt="Azure Devops symbol server" /></p>
<ol start="2">
<li><p>Configure the debugger settings:</p>
<ol>
<li>Navigate to <code>Tools -&gt; Options -&gt; Debugging</code></li>
<li>Ensure that <code>Enable Just My Code</code> is <strong>unchecked</strong></li>
<li>Ensure that <code>Enable source server support</code> is <strong>checked</strong></li>
</ol>
<p><img src="8.DebuggerOptions.png" alt="Azure Devops symbol server" /></p>
</li>
<li><p>Configure which symbols to load automatically <strong>(optional but recommended)</strong>:</p>
<p>By default symbols will automatically be loaded (after being downloaded) if they are available in any of the symbol servers. If an application references a number of packages where symbols are available, start-up time when running and debugging can be dramatically negatively impacted.<br />
Visual Studio can be configured to only load the packages specified - or only load packages based on a wildcard (this is incredibly useful if all NuGet packages share a common namespace structure, as might be the case especially in a corporate environment)</p>
<ol>
<li>Navigate to <code>Tools -&gt; Options -&gt; Debugging -&gt; Symbols</code></li>
<li>Select <code>Load only specific modules</code></li>
<li>Click <code>Specify included modules</code></li>
<li>Click <code>New Module</code></li>
<li>Add the module name, or wildcard format</li>
</ol>
<p><img src="9.SpecificModules.png" alt="Specify which modules to load" /></p>
</li>
</ol>
<hr />
<h2 id="nuget-symbol-package">NuGet symbol package</h2>
<p>This post focuses on building and hosting the symbols using Azure Devops - but just a small note publishing to NuGet.org if the package is publicly available.<br />
The <a href="http://nuget.org/">nuget.org</a> symbol server uses the <code>.snupkg</code> file format for symbols, which are optionally generated when the nupkg file is generated. See this this <a href="https://docs.microsoft.com/en-us/nuget/create-packages/symbol-packages-snupkg">document on the various ways of generating a .snupkg file</a>.</p>
<hr />
<h2 id="final-thoughts">Final thoughts</h2>
<p>That's all there is to it!
Whether a package author or package consumer, having the option to step into the code will prove invaluable - with practically no additional development effort.</p>
<p>If possible (if the source code can be made public), I highly recommend making the symbols available, to everyone's benefit!</p>
<hr />
<h2 id="references">References</h2>
<p><a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/artifacts/symbols?view=azure-devops">Symbol files</a><br />
<a href="https://docs.microsoft.com/en-us/azure/devops/artifacts/concepts/symbols?view=azure-devops">Publishing symbols</a><br />
<a href="https://devblogs.microsoft.com/nuget/improved-package-debugging-experience-with-the-nuget-org-symbol-server/">NuGet symbols (slightly outdated, but still useful)</a></p>

                        
<div>
            <a role="button" href="/tags/c" class="badge badge-light"> c#</a>
            <a role="button" href="/tags/net" class="badge badge-light"> .net</a>
            <a role="button" href="/tags/azuredevops" class="badge badge-light"> azuredevops</a>
            <a role="button" href="/tags/nuget" class="badge badge-light"> nuget</a>
            <a role="button" href="/tags/devops" class="badge badge-light"> devops</a>
            <a role="button" href="/tags/package" class="badge badge-light"> package</a>
            <a role="button" href="/tags/symbol" class="badge badge-light"> symbol</a>
            <a role="button" href="/tags/symbolserver" class="badge badge-light"> symbolserver</a>
            <a role="button" href="/tags/sourcelink" class="badge badge-light"> sourcelink</a>
</div>
                    </div>
                    <div id="content" class="col-md-3 post-with-toc d-none d-lg-block">
                        

        <div class="box sticky-top toc-block">
            <h3 class="no-anchor">On This Page</h3>
            <ul>
        <li><a href="#symbol-server-explained">Symbol server explained</a></li>
            <ul>
        <li><a href="#what-are-symbols">What are symbols?</a></li>
        <li><a href="#what-is-a-symbol-server">What is a symbol server?</a></li>
            </ul>
        <li><a href="#why-use-a-symbol-server">Why use a symbol server</a></li>
        <li><a href="#producing-symbols">Producing symbols</a></li>
            <ul>
        <li><a href="#configuring-code">Configuring code</a></li>
        <li><a href="#configuring-cicd-pipeline">Configuring CI/CD pipeline</a></li>
            </ul>
        <li><a href="#consuming-symbols">Consuming symbols</a></li>
            <ul>
        <li><a href="#configuring-visual-studio">Configuring Visual Studio</a></li>
            </ul>
        <li><a href="#nuget-symbol-package">NuGet symbol package</a></li>
        <li><a href="#final-thoughts">Final thoughts</a></li>
        <li><a href="#references">References</a></li>
            </ul>
        </div>

                    </div>
            </div>
            <div class="row ">
                    <div id="content" class="col-md-9">
                        <div>
    <script src="https://giscus.app/client.js"
            data-repo="always-developing/always-developing.github.io"
            data-repo-id="R_kgDOGQJLBQ"
            data-category="Comments"
            data-category-id="DIC_kwDOGQJLBc4B_pUA"
            data-mapping="pathname"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="transparent_dark"
            data-lang="en"
            crossorigin="anonymous"
            async>
    </script>
</div>
                    </div>
            </div>
    </div>

    <hr class="horizontal-rule" />

    <!-- Footer -->
    <footer>
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <ul class="list-inline text-center">
                    <li class="list-inline-item">
                        <a href="https://github.com/always-developing">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse footer-icon"></i>
                            </span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="https://www.linkedin.com/in/jean-pierre-seini">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin fa-stack-1x fa-inverse footer-icon"></i>
                            </span>
                        </a>
                    </li>
                </ul>
                <div>
                    <p class="copyright text-footer">
                        Copyright © 2022 Always Developing</a>.
                    </p>
                </div>
                <ul class="list-inline text-center small text-feeds">
                        <li class="list-inline-item">
                            <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
                        </li>
                        <li class="list-inline-item">
                            <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        </li>
                </ul>
                <ul class="list-inline text-center small">
                    <li class="list-inline-item">
                        <a href="https://github.com/always-developing/alwaysdeveloping-website-src"><i class="fab fa-github"></i> This site on GitHub</a>                    
                    </li>
                    <li class="list-inline-item">
                        |
                    </li>
                    <li class="list-inline-item">
                        <a href="https://github.com/always-developing/alwaysdeveloping-website-src/tree/main/theme"><i class="fa fa-code"></i> Custom Always-Developing theme</a>
                    </li>
                    <li class="list-inline-item">
                        |
                    </li>
                    <li class="list-inline-item">
                        <a href="https://github.com/statiqdev/CleanBlog"><i class="fa fa-blog"></i> Adapted from Clean Blog theme</a>
                    </li>
                </ul>
                <div class="small text-footer">
                    <a href="https://statiq.dev"><i class="fa fa-cogs"></i> Generated by Statiq</a>
                </div>
            </div>
        </div>
    </div>
</footer>

    <!-- Bootstrap core JavaScript -->
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CXPLFS7K38"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CXPLFS7K38');
</script>

    

    <!-- Custom scripts for this template -->
    <script src="/js/always-developing-blog.js"></script>

</body>

</html>
