<!doctype html><html lang=en-uk>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Different methods of registering the same interface with multiple implementations using .NET dependency injection"><title>Multiple implementations of same interface - the options</title>
<link rel=canonical href=https://always-developing.github.io/p/multiple-implementations/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Multiple implementations of same interface - the options">
<meta property="og:description" content="Different methods of registering the same interface with multiple implementations using .NET dependency injection">
<meta property="og:url" content="https://always-developing.github.io/p/multiple-implementations/">
<meta property="og:site_name" content="Always Developing">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="c#"><meta property="article:tag" content=".net"><meta property="article:tag" content="dependency injection"><meta property="article:tag" content="DI"><meta property="article:tag" content="dependency"><meta property="article:tag" content="injection"><meta property="article:tag" content="rollcall"><meta property="article:tag" content="transient"><meta property="article:tag" content="singleton"><meta property="article:tag" content="scoped"><meta property="article:tag" content="multiple implementation"><meta property="article:tag" content="implementation"><meta property="article:tag" content="interface"><meta property="article:tag" content="multiple"><meta property="article:published_time" content="2021-11-06T01:00:00+02:00"><meta property="article:modified_time" content="2021-11-06T01:00:00+02:00">
<meta name=twitter:title content="Multiple implementations of same interface - the options">
<meta name=twitter:description content="Different methods of registering the same interface with multiple implementations using .NET dependency injection">
<link rel="shortcut icon" href=favicon.ico>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CXPLFS7K38"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-CXPLFS7K38',{anonymize_ip:!1})}</script>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"dark")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=https://always-developing.github.io/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/blog/>
Blog
</a>
</header>
<h2 class=article-title>
<a href=/p/multiple-implementations/>Multiple implementations of same interface - the options</a>
</h2>
<h3 class=article-subtitle>
Different methods of registering the same interface with multiple implementations using .NET dependency injection
</h3>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Nov 06, 2021</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
20 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h2 id=the-challenge>The challenge</h2>
<p>Consider a scenario where the requirement is to upload a file to an online provider (AWS S3, Azure Blob or a FTP site in the examples below), where the provider can be easily changed (either dynamically at runtime, or easily with minimal code changes), with the possibility additional providers being added in future.</p>
<p>To make use of dependency injection, a generic interface is created, <strong><em>IFileUploader</em></strong>, along with three implementations <strong><em>AWSUploader</em></strong>, <strong><em>AzureUploader</em></strong> and <strong><em>FTPUploader</em></strong>. The interface prescribes that the implementations provide a method to upload a file (<em>UploadFile</em>) and a method to get the implementation name (<em>GetName</em>).</p>
<p>The built in .NET dependency injection (DI) container is all one will need for almost all situations (including this situation): however this scenario can be a bit more challenging to get right - <strong><code>with multiple implementations of the same interface, how do you get the right implementation from the DI container?</code></strong></p>
<h2 id=the-problem-with-net-dependency-injection-container>The problem with .NET dependency injection container</h2>
<p>One piece of functionality the .NET DI container does not have (which is available in some other 3rd party DI/IoC containers) is the ability to add and retrieve service implementations by name.</p>
<p>Short of actually implementing one of these other 3rd party containers, below are a number of different options and techniques one can use to get the correct implementation from the DI container when there are multiple implementations registered.</p>
<blockquote>
<div>
<div style=width:5%;float:left;vertical-align:middle;padding-right:60px>
<i class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-info-circle" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#00abfb" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><line x1="12" y1="8" x2="12.01" y2="8"/><polyline points="11 12 12 12 12 16 13 16"/></svg></i>
</div>
<div>
<p>The benchmarks on the below techniques were all executed at the same time under the same conditions using <a href=https://benchmarkdotnet.org/articles/overview.html><strong>BenchmarkDotNet</strong></a><br>
Even though some some techniques performed poorly when compared to others, bear in mind that the time frame in question here is nanoseconds (a nanosecond is <strong>one billionth of a second</strong>).<br>
In <em>most</em> scenarios, the DI technique used (if used correctly) is not going to make a massive material different to the performance of the application/service (of course there are exceptions, depending on how complicated the dependency tree is)</p>
</div>
</div>
</blockquote>
<h2 id=the-different-techniques>The different techniques</h2>
<h3 id=ienumerable>IEnumerable</h3>
<ul>
<li>
<p><strong>Configuration:</strong><br>
This is the simplest &lsquo;out of the box&rsquo; technique, with the various implementations just all added to the DI container using the same interface (<a class=link href=#ienumconfig-7>lines 7-9</a>):
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=ienumconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-1> 1</a>
</span><span class=lnt id=ienumconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-2> 2</a>
</span><span class=lnt id=ienumconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-3> 3</a>
</span><span class=lnt id=ienumconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-4> 4</a>
</span><span class=lnt id=ienumconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-5> 5</a>
</span><span class=lnt id=ienumconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-6> 6</a>
</span><span class=lnt id=ienumconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-7> 7</a>
</span><span class=lnt id=ienumconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-8> 8</a>
</span><span class=lnt id=ienumconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-9> 9</a>
</span><span class=lnt id=ienumconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-10>10</a>
</span><span class=lnt id=ienumconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#ienumconfig-11>11</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>private</span> <span class=k>readonly</span> <span class=n>IHost</span> <span class=n>host</span><span class=p>;</span>
<span class=k>public</span> <span class=n>EnumerableBenchmark</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>host</span> <span class=p>=</span> <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>context</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>services</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>EnumerableHandler</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>,</span> <span class=n>AWSUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>,</span> <span class=n>AzureUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>,</span> <span class=n>FTPUploader</span><span class=p>&gt;()</span>
        <span class=p>).</span><span class=n>Build</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Usage:</strong><br>
Inject IEnumerable into the relevant class (<a class=link href=#ienumusage-4>line 4</a>), and then retrieve the required implementation from the IEnumerable collection (<a class=link href=#ienumusage-11>lines 11-13</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=ienumusage-1><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-1> 1</a>
</span><span class=lnt id=ienumusage-2><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-2> 2</a>
</span><span class=lnt id=ienumusage-3><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-3> 3</a>
</span><span class=lnt id=ienumusage-4><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-4> 4</a>
</span><span class=lnt id=ienumusage-5><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-5> 5</a>
</span><span class=lnt id=ienumusage-6><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-6> 6</a>
</span><span class=lnt id=ienumusage-7><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-7> 7</a>
</span><span class=lnt id=ienumusage-8><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-8> 8</a>
</span><span class=lnt id=ienumusage-9><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-9> 9</a>
</span><span class=lnt id=ienumusage-10><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-10>10</a>
</span><span class=lnt id=ienumusage-11><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-11>11</a>
</span><span class=lnt id=ienumusage-12><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-12>12</a>
</span><span class=lnt id=ienumusage-13><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-13>13</a>
</span><span class=lnt id=ienumusage-14><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-14>14</a>
</span><span class=lnt id=ienumusage-15><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-15>15</a>
</span><span class=lnt id=ienumusage-16><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-16>16</a>
</span><span class=lnt id=ienumusage-17><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-17>17</a>
</span><span class=lnt id=ienumusage-18><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-18>18</a>
</span><span class=lnt id=ienumusage-19><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-19>19</a>
</span><span class=lnt id=ienumusage-20><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-20>20</a>
</span><span class=lnt id=ienumusage-21><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-21>21</a>
</span><span class=lnt id=ienumusage-22><a style=outline:none;text-decoration:none;color:inherit href=#ienumusage-22>22</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>EnumerableHandler</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;</span> <span class=m>_</span><span class=n>uploaders</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>EnumerableHandler</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;</span> <span class=n>uploaders</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>uploaders</span> <span class=p>=</span> <span class=n>uploaders</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>providerName</span> <span class=p>=</span> <span class=s>&#34;aws&#34;</span><span class=p>;</span>
        <span class=kt>var</span> <span class=n>uploader</span> <span class=p>=</span> <span class=m>_</span><span class=n>uploaders</span><span class=p>.</span><span class=n>FirstOrDefault</span><span class=p>(</span><span class=n>up</span> <span class=p>=&gt;</span> <span class=n>up</span>
            <span class=p>.</span><span class=n>GetName</span><span class=p>().</span><span class=n>Equals</span><span class=p>(</span><span class=n>providerName</span><span class=p>));</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>uploader</span> <span class=p>==</span> <span class=k>null</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgumentException</span><span class=p>(</span><span class=s>$&#34;No uploader with name &#34;</span> <span class=p>+</span>
                    <span class=s>$&#34;{providerName} could be found&#34;</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>uploader</span><span class=p>.</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Pros:</strong></p>
<ul>
<li>Easy to implement</li>
<li>Implementation can be selected/changed at runtime</li>
</ul>
</li>
<li>
<p><strong>Cons:</strong></p>
<ul>
<li>Every implementation is instantiated (as part of IEnumerable) even if not required or used. This could be especially problematic if the implementations themselves have a number of dependencies which then need to be instantiated (this was NOT the case with the benchmarks) which could result in a negative performance impact.</li>
<li>The logic to retrieve the implementation from IEnumerable is contained in multiple places (each class which has it injected)</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
<th style=text-align:right>Mean</th>
<th style=text-align:right>Error</th>
<th style=text-align:right>StdDev</th>
<th style=text-align:right>Ratio</th>
<th style=text-align:right>RatioSD</th>
<th style=text-align:right>Gen 0</th>
<th style=text-align:right>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enumerable</td>
<td>Execute</td>
<td style=text-align:right>86.99 ns</td>
<td style=text-align:right>0.987 ns</td>
<td style=text-align:right>0.924 ns</td>
<td style=text-align:right>1.00</td>
<td style=text-align:right>0.00</td>
<td style=text-align:right>0.0421</td>
<td style=text-align:right>264 B</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr>
<h3 id=factory>Factory</h3>
<p>One of the negative aspects of the <code>IEnumerable</code> approach, is that the logic to retrieve the correct implementation could be present in multiple places (if IEnumberable is injected into multiple classes). The <code>Factory</code> approach moves the logic into a separate actory class, which is then injected and is responsible for retrieving the required implementation.</p>
<ul>
<li>
<p><strong>Configuration:</strong><br>
Configuration is the <em>same as <code>IEnumerable</code></em>, the various implementations all added to the DI container using the same interface, with one additional class added, the factory class (<a class=link href=#factoryconfig-7>line 7</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=factoryconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-1> 1</a>
</span><span class=lnt id=factoryconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-2> 2</a>
</span><span class=lnt id=factoryconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-3> 3</a>
</span><span class=lnt id=factoryconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-4> 4</a>
</span><span class=lnt id=factoryconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-5> 5</a>
</span><span class=lnt id=factoryconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-6> 6</a>
</span><span class=lnt id=factoryconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-7> 7</a>
</span><span class=lnt id=factoryconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-8> 8</a>
</span><span class=lnt id=factoryconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-9> 9</a>
</span><span class=lnt id=factoryconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-10>10</a>
</span><span class=lnt id=factoryconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-11>11</a>
</span><span class=lnt id=factoryconfig-12><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-12>12</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>private</span> <span class=k>readonly</span> <span class=n>IHost</span> <span class=n>host</span><span class=p>;</span>
<span class=k>public</span> <span class=n>FactoryBenchmark</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>host</span> <span class=p>=</span> <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>context</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>services</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>FactoryHandler</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>FileUploaderFactory</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>,</span> <span class=n>AWSUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>,</span> <span class=n>AzureUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>,</span> <span class=n>FTPUploader</span><span class=p>&gt;()</span>
        <span class=p>).</span><span class=n>Build</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
<p>The factory looks very similar to the handler from the <code>IEnumerable</code> approach:
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=factoryconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-1> 1</a>
</span><span class=lnt id=factoryconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-2> 2</a>
</span><span class=lnt id=factoryconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-3> 3</a>
</span><span class=lnt id=factoryconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-4> 4</a>
</span><span class=lnt id=factoryconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-5> 5</a>
</span><span class=lnt id=factoryconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-6> 6</a>
</span><span class=lnt id=factoryconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-7> 7</a>
</span><span class=lnt id=factoryconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-8> 8</a>
</span><span class=lnt id=factoryconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-9> 9</a>
</span><span class=lnt id=factoryconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-10>10</a>
</span><span class=lnt id=factoryconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-11>11</a>
</span><span class=lnt id=factoryconfig-12><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-12>12</a>
</span><span class=lnt id=factoryconfig-13><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-13>13</a>
</span><span class=lnt id=factoryconfig-14><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-14>14</a>
</span><span class=lnt id=factoryconfig-15><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-15>15</a>
</span><span class=lnt id=factoryconfig-16><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-16>16</a>
</span><span class=lnt id=factoryconfig-17><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-17>17</a>
</span><span class=lnt id=factoryconfig-18><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-18>18</a>
</span><span class=lnt id=factoryconfig-19><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-19>19</a>
</span><span class=lnt id=factoryconfig-20><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-20>20</a>
</span><span class=lnt id=factoryconfig-21><a style=outline:none;text-decoration:none;color:inherit href=#factoryconfig-21>21</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>FileUploaderFactory</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;</span> <span class=m>_</span><span class=n>uploaders</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>FileUploaderFactory</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;</span> <span class=n>uploaders</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>uploaders</span> <span class=p>=</span> <span class=n>uploaders</span><span class=p>;</span> 
    <span class=p>}</span>

    <span class=k>public</span> <span class=n>IFileUploader</span> <span class=n>Resolve</span><span class=p>(</span><span class=kt>string</span> <span class=n>providerName</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>uploader</span> <span class=p>=</span> <span class=m>_</span><span class=n>uploaders</span><span class=p>.</span><span class=n>FirstOrDefault</span><span class=p>(</span><span class=n>up</span> <span class=p>=&gt;</span> <span class=n>up</span>
            <span class=p>.</span><span class=n>GetName</span><span class=p>().</span><span class=n>Equals</span><span class=p>(</span><span class=n>providerName</span><span class=p>));</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>uploader</span> <span class=p>==</span> <span class=k>null</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgumentException</span><span class=p>(</span><span class=s>$&#34;No uploader with name &#34;</span> <span class=p>+</span>
                    <span class=s>$&#34;{providerName} could be found&#34;</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=k>return</span> <span class=n>uploader</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Usage:</strong><br>
The factory is now injected into the relevant class (<a class=link href=#factoryusage-4>line 4</a>) and is then invoked to get the requested implementation (<a class=link href=#factoryusage-12>line 12</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=factoryusage-1><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-1> 1</a>
</span><span class=lnt id=factoryusage-2><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-2> 2</a>
</span><span class=lnt id=factoryusage-3><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-3> 3</a>
</span><span class=lnt id=factoryusage-4><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-4> 4</a>
</span><span class=lnt id=factoryusage-5><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-5> 5</a>
</span><span class=lnt id=factoryusage-6><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-6> 6</a>
</span><span class=lnt id=factoryusage-7><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-7> 7</a>
</span><span class=lnt id=factoryusage-8><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-8> 8</a>
</span><span class=lnt id=factoryusage-9><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-9> 9</a>
</span><span class=lnt id=factoryusage-10><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-10>10</a>
</span><span class=lnt id=factoryusage-11><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-11>11</a>
</span><span class=lnt id=factoryusage-12><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-12>12</a>
</span><span class=lnt id=factoryusage-13><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-13>13</a>
</span><span class=lnt id=factoryusage-14><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-14>14</a>
</span><span class=lnt id=factoryusage-15><a style=outline:none;text-decoration:none;color:inherit href=#factoryusage-15>15</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span>  <span class=k>class</span> <span class=nc>FactoryHandler</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>FileUploaderFactory</span> <span class=m>_f</span><span class=n>actory</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>FactoryHandler</span><span class=p>(</span><span class=n>FileUploaderFactory</span> <span class=n>factory</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_f</span><span class=n>actory</span> <span class=p>=</span> <span class=n>factory</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>providerName</span> <span class=p>=</span> <span class=s>&#34;azure&#34;</span><span class=p>;</span>
        <span class=kt>var</span> <span class=n>uploader</span> <span class=p>=</span> <span class=m>_f</span><span class=n>actory</span><span class=p>.</span><span class=n>Resolve</span><span class=p>(</span><span class=n>providerName</span><span class=p>);</span>
        <span class=n>uploader</span><span class=p>.</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Pros:</strong></p>
<ul>
<li>Easy to implement</li>
<li>Implementation can be selected/changed at runtime</li>
<li>Retrieval logic is contained in a single place</li>
</ul>
</li>
<li>
<p><strong>Cons:</strong></p>
<ul>
<li>Every implementation is instantiated (as part of IEnumerable) even if not required or used. This could have an impact on performance and memory usage.</li>
<li>Slightly slower, and slightly more memory usage than the <code>IEnumerable</code> approach (due to the extra layer between the handler and the IEnumerable collection)</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
<th style=text-align:right>Mean</th>
<th style=text-align:right>Error</th>
<th style=text-align:right>StdDev</th>
<th style=text-align:right>Ratio</th>
<th style=text-align:right>RatioSD</th>
<th style=text-align:right>Gen 0</th>
<th style=text-align:right>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enumerable</td>
<td>Execute</td>
<td style=text-align:right>86.99 ns</td>
<td style=text-align:right>0.987 ns</td>
<td style=text-align:right>0.924 ns</td>
<td style=text-align:right>1.00</td>
<td style=text-align:right>0.00</td>
<td style=text-align:right>0.0421</td>
<td style=text-align:right>264 B</td>
</tr>
<tr>
<td>Factory</td>
<td>Execute</td>
<td style=text-align:right>103.20 ns</td>
<td style=text-align:right>1.324 ns</td>
<td style=text-align:right>1.238 ns</td>
<td style=text-align:right>1.19</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0459</td>
<td style=text-align:right>288 B</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr>
<h3 id=type-factory>Type Factory</h3>
<p>A big negative aspect of the <code>IEnumerable</code> and <code>Factory</code> approach, is that all the implementations are instantiated every time, even if not used or required. This could have big impact on performance and memory if the implementations them themselves have many dependencies (and those dependencies have dependencies and so on).<br>
The next approach is extends on the <code>Factory</code> technique, but only instantiates the requested implementation <strong>based on naming conventions</strong>.</p>
<ul>
<li>
<p><strong>Configuration:</strong><br>
Setup is the same as with the <code>Factory</code> method.
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=typefactoryconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-1> 1</a>
</span><span class=lnt id=typefactoryconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-2> 2</a>
</span><span class=lnt id=typefactoryconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-3> 3</a>
</span><span class=lnt id=typefactoryconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-4> 4</a>
</span><span class=lnt id=typefactoryconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-5> 5</a>
</span><span class=lnt id=typefactoryconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-6> 6</a>
</span><span class=lnt id=typefactoryconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-7> 7</a>
</span><span class=lnt id=typefactoryconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-8> 8</a>
</span><span class=lnt id=typefactoryconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-9> 9</a>
</span><span class=lnt id=typefactoryconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-10>10</a>
</span><span class=lnt id=typefactoryconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-11>11</a>
</span><span class=lnt id=typefactoryconfig-12><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig-12>12</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>private</span> <span class=k>readonly</span> <span class=n>IHost</span> <span class=n>host</span><span class=p>;</span>
<span class=k>public</span> <span class=n>FactoryBenchmark</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>host</span> <span class=p>=</span> <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>context</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>services</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>TypeFactoryHandler</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>FileUploaderTypeFactory</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>,</span> <span class=n>AWSUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>,</span> <span class=n>AzureUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>,</span> <span class=n>FTPUploader</span><span class=p>&gt;()</span>
        <span class=p>).</span><span class=n>Build</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
<p>The factory in this approach, takes the requested name, finds the type based on the name (<a class=link href=#typefactoryconfig2-11>lines 11-12</a>) and gets it from the DI container (<a class=link href=#typefactoryconfig2-20>line 20</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=typefactoryconfig2-1><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-1> 1</a>
</span><span class=lnt id=typefactoryconfig2-2><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-2> 2</a>
</span><span class=lnt id=typefactoryconfig2-3><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-3> 3</a>
</span><span class=lnt id=typefactoryconfig2-4><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-4> 4</a>
</span><span class=lnt id=typefactoryconfig2-5><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-5> 5</a>
</span><span class=lnt id=typefactoryconfig2-6><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-6> 6</a>
</span><span class=lnt id=typefactoryconfig2-7><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-7> 7</a>
</span><span class=lnt id=typefactoryconfig2-8><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-8> 8</a>
</span><span class=lnt id=typefactoryconfig2-9><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-9> 9</a>
</span><span class=lnt id=typefactoryconfig2-10><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-10>10</a>
</span><span class=lnt id=typefactoryconfig2-11><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-11>11</a>
</span><span class=lnt id=typefactoryconfig2-12><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-12>12</a>
</span><span class=lnt id=typefactoryconfig2-13><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-13>13</a>
</span><span class=lnt id=typefactoryconfig2-14><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-14>14</a>
</span><span class=lnt id=typefactoryconfig2-15><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-15>15</a>
</span><span class=lnt id=typefactoryconfig2-16><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-16>16</a>
</span><span class=lnt id=typefactoryconfig2-17><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-17>17</a>
</span><span class=lnt id=typefactoryconfig2-18><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-18>18</a>
</span><span class=lnt id=typefactoryconfig2-19><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-19>19</a>
</span><span class=lnt id=typefactoryconfig2-20><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-20>20</a>
</span><span class=lnt id=typefactoryconfig2-21><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-21>21</a>
</span><span class=lnt id=typefactoryconfig2-22><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-22>22</a>
</span><span class=lnt id=typefactoryconfig2-23><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryconfig2-23>23</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>FileUploaderTypeFactory</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>IServiceProvider</span> <span class=m>_</span><span class=n>provider</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>FileUploaderTypeFactory</span><span class=p>(</span><span class=n>IServiceProvider</span> <span class=n>provider</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>provider</span> <span class=p>=</span> <span class=n>provider</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=n>IFileUploader</span> <span class=n>Resolve</span><span class=p>(</span><span class=kt>string</span> <span class=n>providerName</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>type</span> <span class=p>=</span> <span class=n>Assembly</span><span class=p>.</span><span class=n>GetAssembly</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>FileUploaderTypeFactory</span><span class=p>)).</span><span class=n>GetType</span><span class=p>(</span>
            <span class=s>$&#34;{typeof(FileUploaderTypeFactory).Namespace}.{providerName}Uploader&#34;</span><span class=p>);</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=p>==</span> <span class=k>null</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgumentException</span><span class=p>(</span><span class=s>$&#34;No uploader with name &#34;</span> <span class=p>+</span>
                    <span class=s>$&#34;{providerName} could be found&#34;</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=kt>var</span> <span class=n>uploader</span> <span class=p>=</span> <span class=m>_</span><span class=n>provider</span><span class=p>.</span><span class=n>GetService</span><span class=p>(</span><span class=n>type</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>uploader</span> <span class=k>as</span> <span class=n>IFileUploader</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Usage:</strong><br>
The factory is now injected into the relevant class (<a class=link href=#typefactoryusage-4>line 4</a>) and is then invoked to get the requested implementation (<a class=link href=#typefactoryusage-12>line 12</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=typefactoryusage-1><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-1> 1</a>
</span><span class=lnt id=typefactoryusage-2><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-2> 2</a>
</span><span class=lnt id=typefactoryusage-3><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-3> 3</a>
</span><span class=lnt id=typefactoryusage-4><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-4> 4</a>
</span><span class=lnt id=typefactoryusage-5><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-5> 5</a>
</span><span class=lnt id=typefactoryusage-6><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-6> 6</a>
</span><span class=lnt id=typefactoryusage-7><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-7> 7</a>
</span><span class=lnt id=typefactoryusage-8><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-8> 8</a>
</span><span class=lnt id=typefactoryusage-9><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-9> 9</a>
</span><span class=lnt id=typefactoryusage-10><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-10>10</a>
</span><span class=lnt id=typefactoryusage-11><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-11>11</a>
</span><span class=lnt id=typefactoryusage-12><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-12>12</a>
</span><span class=lnt id=typefactoryusage-13><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-13>13</a>
</span><span class=lnt id=typefactoryusage-14><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-14>14</a>
</span><span class=lnt id=typefactoryusage-15><a style=outline:none;text-decoration:none;color:inherit href=#typefactoryusage-15>15</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span>  <span class=k>class</span> <span class=nc>TypeFactoryHandler</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>FileUploaderTypeFactory</span> <span class=m>_f</span><span class=n>actory</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>TypeFactoryHandler</span><span class=p>(</span><span class=n>FileUploaderTypeFactory</span> <span class=n>factory</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_f</span><span class=n>actory</span> <span class=p>=</span> <span class=n>factory</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>providerName</span> <span class=p>=</span> <span class=s>&#34;Azure&#34;</span><span class=p>;</span>
        <span class=kt>var</span> <span class=n>uploader</span> <span class=p>=</span> <span class=m>_f</span><span class=n>actory</span><span class=p>.</span><span class=n>Resolve</span><span class=p>(</span><span class=n>providerName</span><span class=p>);</span>
        <span class=n>uploader</span><span class=p>.</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Pros:</strong></p>
<ul>
<li>Not all implementations are instantiated</li>
<li>Better memory usage compared to other two approaches so far</li>
<li>Implementation can be selected/changed at runtime</li>
<li>Retrieval logic is contained in a single place</li>
</ul>
</li>
<li>
<p><strong>Cons:</strong></p>
<ul>
<li>Use of reflection to convert the name to a Type does have an big impact on performance</li>
<li>Strict naming convention has to be followed in order for the reflection logic to work correctly</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
<th style=text-align:right>Mean</th>
<th style=text-align:right>Error</th>
<th style=text-align:right>StdDev</th>
<th style=text-align:right>Ratio</th>
<th style=text-align:right>RatioSD</th>
<th style=text-align:right>Gen 0</th>
<th style=text-align:right>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enumerable</td>
<td>Execute</td>
<td style=text-align:right>86.99 ns</td>
<td style=text-align:right>0.987 ns</td>
<td style=text-align:right>0.924 ns</td>
<td style=text-align:right>1.00</td>
<td style=text-align:right>0.00</td>
<td style=text-align:right>0.0421</td>
<td style=text-align:right>264 B</td>
</tr>
<tr>
<td>Factory</td>
<td>Execute</td>
<td style=text-align:right>103.20 ns</td>
<td style=text-align:right>1.324 ns</td>
<td style=text-align:right>1.238 ns</td>
<td style=text-align:right>1.19</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0459</td>
<td style=text-align:right>288 B</td>
</tr>
<tr>
<td>TypeFactory</td>
<td>Execute</td>
<td style=text-align:right>525.19 ns</td>
<td style=text-align:right>2.624 ns</td>
<td style=text-align:right>2.455 ns</td>
<td style=text-align:right>6.04</td>
<td style=text-align:right>0.07</td>
<td style=text-align:right>0.0277</td>
<td style=text-align:right>176 B</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr>
<h3 id=delegate>Delegate</h3>
<p>The next approach tries to achieve the same as the <code>Type Factory</code> approach - not instantiating every implementation, but using a different technique.<br>
In short, a delegate is called at runtime when an implementation is requested, and using a switch statement the correct one is determined and returned.</p>
<ul>
<li>
<p><strong>Configuration:</strong><br>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=delegateconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-1> 1</a>
</span><span class=lnt id=delegateconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-2> 2</a>
</span><span class=lnt id=delegateconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-3> 3</a>
</span><span class=lnt id=delegateconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-4> 4</a>
</span><span class=lnt id=delegateconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-5> 5</a>
</span><span class=lnt id=delegateconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-6> 6</a>
</span><span class=lnt id=delegateconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-7> 7</a>
</span><span class=lnt id=delegateconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-8> 8</a>
</span><span class=lnt id=delegateconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-9> 9</a>
</span><span class=lnt id=delegateconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-10>10</a>
</span><span class=lnt id=delegateconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-11>11</a>
</span><span class=lnt id=delegateconfig-12><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-12>12</a>
</span><span class=lnt id=delegateconfig-13><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-13>13</a>
</span><span class=lnt id=delegateconfig-14><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-14>14</a>
</span><span class=lnt id=delegateconfig-15><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-15>15</a>
</span><span class=lnt id=delegateconfig-16><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-16>16</a>
</span><span class=lnt id=delegateconfig-17><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-17>17</a>
</span><span class=lnt id=delegateconfig-18><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-18>18</a>
</span><span class=lnt id=delegateconfig-19><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-19>19</a>
</span><span class=lnt id=delegateconfig-20><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-20>20</a>
</span><span class=lnt id=delegateconfig-21><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-21>21</a>
</span><span class=lnt id=delegateconfig-22><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-22>22</a>
</span><span class=lnt id=delegateconfig-23><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-23>23</a>
</span><span class=lnt id=delegateconfig-24><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-24>24</a>
</span><span class=lnt id=delegateconfig-25><a style=outline:none;text-decoration:none;color:inherit href=#delegateconfig-25>25</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>private</span> <span class=k>readonly</span> <span class=n>IHost</span> <span class=n>host</span><span class=p>;</span>
<span class=k>public</span> <span class=n>DelegateBenchmark</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>host</span> <span class=p>=</span> <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>context</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>services</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>DelegateHandler</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>DelegateResolver</span><span class=p>&gt;(</span><span class=n>serviceProvider</span> <span class=p>=&gt;</span> <span class=n>providerName</span> <span class=p>=&gt;</span>
            <span class=p>{</span>
                <span class=k>switch</span> <span class=p>(</span><span class=n>providerName</span><span class=p>)</span>
                <span class=p>{</span>
                    <span class=k>case</span> <span class=s>&#34;aws&#34;</span><span class=p>:</span>
                        <span class=k>return</span> <span class=n>serviceProvider</span><span class=p>.</span><span class=n>GetService</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;();</span>
                    <span class=k>case</span> <span class=s>&#34;azure&#34;</span><span class=p>:</span>
                        <span class=k>return</span> <span class=n>serviceProvider</span><span class=p>.</span><span class=n>GetService</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;();</span>
                    <span class=k>case</span> <span class=s>&#34;ftp&#34;</span><span class=p>:</span>
                        <span class=k>return</span> <span class=n>serviceProvider</span><span class=p>.</span><span class=n>GetService</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;();</span>
                    <span class=k>default</span><span class=p>:</span>
                        <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgumentException</span><span class=p>(</span><span class=s>$&#34;No uploader with &#34;</span> <span class=p>+</span>
                                <span class=s>$&#34;name {providerName} could be found&#34;</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>})).</span><span class=n>Build</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
<p>The DelegateResolver is as follows
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=delegateresolver-1><a style=outline:none;text-decoration:none;color:inherit href=#delegateresolver-1>1</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#>    <span class=k>public</span> <span class=k>delegate</span> <span class=n>IFileUploader</span> <span class=n>DelegateResolver</span><span class=p>(</span><span class=kt>string</span> <span class=n>providerName</span><span class=p>);</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Usage:</strong><br>
The delegate is now injected into the relevant class (<a class=link href=#delegateusage-4>line 4</a>) and is then invoked to get the requested implementation (<a class=link href=#delegateusage-11>line 11</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=delegateusage-1><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-1> 1</a>
</span><span class=lnt id=delegateusage-2><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-2> 2</a>
</span><span class=lnt id=delegateusage-3><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-3> 3</a>
</span><span class=lnt id=delegateusage-4><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-4> 4</a>
</span><span class=lnt id=delegateusage-5><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-5> 5</a>
</span><span class=lnt id=delegateusage-6><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-6> 6</a>
</span><span class=lnt id=delegateusage-7><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-7> 7</a>
</span><span class=lnt id=delegateusage-8><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-8> 8</a>
</span><span class=lnt id=delegateusage-9><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-9> 9</a>
</span><span class=lnt id=delegateusage-10><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-10>10</a>
</span><span class=lnt id=delegateusage-11><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-11>11</a>
</span><span class=lnt id=delegateusage-12><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-12>12</a>
</span><span class=lnt id=delegateusage-13><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-13>13</a>
</span><span class=lnt id=delegateusage-14><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-14>14</a>
</span><span class=lnt id=delegateusage-15><a style=outline:none;text-decoration:none;color:inherit href=#delegateusage-15>15</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>DelegateHandler</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>DelegateResolver</span> <span class=m>_</span><span class=n>resolver</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>DelegateHandler</span><span class=p>(</span><span class=n>DelegateResolver</span> <span class=n>resovler</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>resolver</span> <span class=p>=</span> <span class=n>resovler</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>uploader</span> <span class=p>=</span> <span class=m>_</span><span class=n>resolver</span><span class=p>(</span><span class=s>&#34;ftp&#34;</span><span class=p>);</span>
        <span class=n>uploader</span><span class=p>.</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>

<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Pros:</strong></p>
<ul>
<li>Not all implementations are instantiated</li>
<li>Best memory usage compared to other approaches so far</li>
<li>Implementation can be selected/changed at runtime</li>
<li>Retrieval logic is contained in a single place</li>
</ul>
</li>
<li>
<p><strong>Cons:</strong></p>
<ul>
<li>Slightly more complicated setup with the delegate and switch statement compared to other approaches</li>
<li>Switch statement is hardcoded and needs to be manually maintained every time a new provider is added</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
<th style=text-align:right>Mean</th>
<th style=text-align:right>Error</th>
<th style=text-align:right>StdDev</th>
<th style=text-align:right>Ratio</th>
<th style=text-align:right>RatioSD</th>
<th style=text-align:right>Gen 0</th>
<th style=text-align:right>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enumerable</td>
<td>Execute</td>
<td style=text-align:right>86.99 ns</td>
<td style=text-align:right>0.987 ns</td>
<td style=text-align:right>0.924 ns</td>
<td style=text-align:right>1.00</td>
<td style=text-align:right>0.00</td>
<td style=text-align:right>0.0421</td>
<td style=text-align:right>264 B</td>
</tr>
<tr>
<td>Factory</td>
<td>Execute</td>
<td style=text-align:right>103.20 ns</td>
<td style=text-align:right>1.324 ns</td>
<td style=text-align:right>1.238 ns</td>
<td style=text-align:right>1.19</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0459</td>
<td style=text-align:right>288 B</td>
</tr>
<tr>
<td>TypeFactory</td>
<td>Execute</td>
<td style=text-align:right>525.19 ns</td>
<td style=text-align:right>2.624 ns</td>
<td style=text-align:right>2.455 ns</td>
<td style=text-align:right>6.04</td>
<td style=text-align:right>0.07</td>
<td style=text-align:right>0.0277</td>
<td style=text-align:right>176 B</td>
</tr>
<tr>
<td>Delegate</td>
<td>Execute</td>
<td style=text-align:right>111.45 ns</td>
<td style=text-align:right>1.456 ns</td>
<td style=text-align:right>1.291 ns</td>
<td style=text-align:right>1.28</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0178</td>
<td style=text-align:right>112 B</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr>
<h3 id=type-delegate>Type Delegate</h3>
<p>The next approach extends the <code>Delegate</code> technique, and uses reflection and naming conventions to get the Type dynamically.</p>
<ul>
<li>
<p><strong>Configuration:</strong><br>
Setup is as follows, very similar to the <code>Delegate</code> approach, but instead of the switch statement, reflection is used to get the Type based on naming conventions.
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=typedelegateconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-1> 1</a>
</span><span class=lnt id=typedelegateconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-2> 2</a>
</span><span class=lnt id=typedelegateconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-3> 3</a>
</span><span class=lnt id=typedelegateconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-4> 4</a>
</span><span class=lnt id=typedelegateconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-5> 5</a>
</span><span class=lnt id=typedelegateconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-6> 6</a>
</span><span class=lnt id=typedelegateconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-7> 7</a>
</span><span class=lnt id=typedelegateconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-8> 8</a>
</span><span class=lnt id=typedelegateconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-9> 9</a>
</span><span class=lnt id=typedelegateconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-10>10</a>
</span><span class=lnt id=typedelegateconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-11>11</a>
</span><span class=lnt id=typedelegateconfig-12><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-12>12</a>
</span><span class=lnt id=typedelegateconfig-13><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-13>13</a>
</span><span class=lnt id=typedelegateconfig-14><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-14>14</a>
</span><span class=lnt id=typedelegateconfig-15><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-15>15</a>
</span><span class=lnt id=typedelegateconfig-16><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-16>16</a>
</span><span class=lnt id=typedelegateconfig-17><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-17>17</a>
</span><span class=lnt id=typedelegateconfig-18><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-18>18</a>
</span><span class=lnt id=typedelegateconfig-19><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-19>19</a>
</span><span class=lnt id=typedelegateconfig-20><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-20>20</a>
</span><span class=lnt id=typedelegateconfig-21><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-21>21</a>
</span><span class=lnt id=typedelegateconfig-22><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-22>22</a>
</span><span class=lnt id=typedelegateconfig-23><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-23>23</a>
</span><span class=lnt id=typedelegateconfig-24><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-24>24</a>
</span><span class=lnt id=typedelegateconfig-25><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-25>25</a>
</span><span class=lnt id=typedelegateconfig-26><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateconfig-26>26</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>private</span> <span class=k>readonly</span> <span class=n>IHost</span> <span class=n>host</span><span class=p>;</span>
<span class=k>public</span> <span class=n>TypeDelegateBenchmark</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>host</span> <span class=p>=</span> <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>context</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>services</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>TypeDelegateHandler</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>TypeDelegateResolver</span><span class=p>&gt;(</span><span class=n>serviceProvider</span> <span class=p>=&gt;</span> <span class=n>providerName</span> <span class=p>=&gt;</span>
            <span class=p>{</span>
                <span class=kt>var</span> <span class=n>type</span> <span class=p>=</span> <span class=n>Assembly</span><span class=p>.</span><span class=n>GetAssembly</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>FileUploaderTypeFactory</span><span class=p>))</span>
                    <span class=p>.</span><span class=n>GetType</span><span class=p>(</span><span class=s>$&#34;{typeof(FileUploaderTypeFactory).Namespace}
</span><span class=s>                    .{providerName}Uploader&#34;</span><span class=p>,</span> <span class=k>false</span><span class=p>,</span> <span class=k>true</span><span class=p>);</span>

                <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=p>==</span> <span class=k>null</span><span class=p>)</span>
                <span class=p>{</span>
                    <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgumentException</span><span class=p>(</span><span class=s>$&#34;No uploader with &#34;</span> <span class=p>+</span>
                                <span class=s>$&#34;name {providerName} could be found&#34;</span><span class=p>);</span>
                <span class=p>}</span>

                <span class=kt>var</span> <span class=n>uploader</span> <span class=p>=</span> <span class=n>serviceProvider</span><span class=p>.</span><span class=n>GetService</span><span class=p>(</span><span class=n>type</span><span class=p>);</span>
                <span class=k>return</span> <span class=n>uploader</span> <span class=k>as</span> <span class=n>IFileUploader</span><span class=p>;</span>

            <span class=p>})).</span><span class=n>Build</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
<p>The DelegateResolver is the same as before.
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=typedelegateresolver-1><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateresolver-1>1</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#>    <span class=k>public</span> <span class=k>delegate</span> <span class=n>IFileUploader</span> <span class=n>DelegateResolver</span><span class=p>(</span><span class=kt>string</span> <span class=n>providerName</span><span class=p>);</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Usage:</strong><br>
The delegate is now injected into the relevant class (<a class=link href=#typedelegateusage-4>line 4</a>) and is then invoked to get the requested implementation (<a class=link href=#typedelegateusage-11>line 11</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=typedelegateusage-1><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-1> 1</a>
</span><span class=lnt id=typedelegateusage-2><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-2> 2</a>
</span><span class=lnt id=typedelegateusage-3><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-3> 3</a>
</span><span class=lnt id=typedelegateusage-4><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-4> 4</a>
</span><span class=lnt id=typedelegateusage-5><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-5> 5</a>
</span><span class=lnt id=typedelegateusage-6><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-6> 6</a>
</span><span class=lnt id=typedelegateusage-7><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-7> 7</a>
</span><span class=lnt id=typedelegateusage-8><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-8> 8</a>
</span><span class=lnt id=typedelegateusage-9><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-9> 9</a>
</span><span class=lnt id=typedelegateusage-10><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-10>10</a>
</span><span class=lnt id=typedelegateusage-11><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-11>11</a>
</span><span class=lnt id=typedelegateusage-12><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-12>12</a>
</span><span class=lnt id=typedelegateusage-13><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-13>13</a>
</span><span class=lnt id=typedelegateusage-14><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-14>14</a>
</span><span class=lnt id=typedelegateusage-15><a style=outline:none;text-decoration:none;color:inherit href=#typedelegateusage-15>15</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>TypeDelegateHandler</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>DelegateResolver</span> <span class=m>_</span><span class=n>resolver</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>TypeDelegateHandler</span><span class=p>(</span><span class=n>DelegateResolver</span> <span class=n>resovler</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>resolver</span> <span class=p>=</span> <span class=n>resovler</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>uploader</span> <span class=p>=</span> <span class=m>_</span><span class=n>resolver</span><span class=p>(</span><span class=s>&#34;ftp&#34;</span><span class=p>);</span>
        <span class=n>uploader</span><span class=p>.</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>

<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Pros:</strong></p>
<ul>
<li>Not all implementations are instantiated</li>
<li>Implementation can be selected/changed at runtime</li>
<li>Retrieval logic is contained in a single place</li>
<li>No switch statement to maintain when a new provider is added</li>
</ul>
</li>
<li>
<p><strong>Cons:</strong></p>
<ul>
<li>Use of reflection to convert the name to a Type does have a large impact on performance</li>
<li>Strict naming convention has to be followed in order for the reflection logic to work correctly</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
<th style=text-align:right>Mean</th>
<th style=text-align:right>Error</th>
<th style=text-align:right>StdDev</th>
<th style=text-align:right>Ratio</th>
<th style=text-align:right>RatioSD</th>
<th style=text-align:right>Gen 0</th>
<th style=text-align:right>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enumerable</td>
<td>Execute</td>
<td style=text-align:right>86.99 ns</td>
<td style=text-align:right>0.987 ns</td>
<td style=text-align:right>0.924 ns</td>
<td style=text-align:right>1.00</td>
<td style=text-align:right>0.00</td>
<td style=text-align:right>0.0421</td>
<td style=text-align:right>264 B</td>
</tr>
<tr>
<td>Factory</td>
<td>Execute</td>
<td style=text-align:right>103.20 ns</td>
<td style=text-align:right>1.324 ns</td>
<td style=text-align:right>1.238 ns</td>
<td style=text-align:right>1.19</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0459</td>
<td style=text-align:right>288 B</td>
</tr>
<tr>
<td>TypeFactory</td>
<td>Execute</td>
<td style=text-align:right>525.19 ns</td>
<td style=text-align:right>2.624 ns</td>
<td style=text-align:right>2.455 ns</td>
<td style=text-align:right>6.04</td>
<td style=text-align:right>0.07</td>
<td style=text-align:right>0.0277</td>
<td style=text-align:right>176 B</td>
</tr>
<tr>
<td>Delegate</td>
<td>Execute</td>
<td style=text-align:right>111.45 ns</td>
<td style=text-align:right>1.456 ns</td>
<td style=text-align:right>1.291 ns</td>
<td style=text-align:right>1.28</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0178</td>
<td style=text-align:right>112 B</td>
</tr>
<tr>
<td>TypeDelegate</td>
<td>Execute</td>
<td style=text-align:right>861.84 ns</td>
<td style=text-align:right>6.599 ns</td>
<td style=text-align:right>5.850 ns</td>
<td style=text-align:right>9.90</td>
<td style=text-align:right>0.15</td>
<td style=text-align:right>0.0343</td>
<td style=text-align:right>216 B</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr>
<h3 id=distinct>Distinct</h3>
<p>The next technique uses a wrapper to make each implementation added to the DI container unique, and hence can be retrieved uniquely.</p>
<ul>
<li>
<p><strong>Configuration:</strong><br>
Additional types are also now required to be defined and added to the DI container, <em>IGenericUploader</em> and <em>GenericUploader</em>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=distinctconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-1> 1</a>
</span><span class=lnt id=distinctconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-2> 2</a>
</span><span class=lnt id=distinctconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-3> 3</a>
</span><span class=lnt id=distinctconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-4> 4</a>
</span><span class=lnt id=distinctconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-5> 5</a>
</span><span class=lnt id=distinctconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-6> 6</a>
</span><span class=lnt id=distinctconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-7> 7</a>
</span><span class=lnt id=distinctconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-8> 8</a>
</span><span class=lnt id=distinctconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-9> 9</a>
</span><span class=lnt id=distinctconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-10>10</a>
</span><span class=lnt id=distinctconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-11>11</a>
</span><span class=lnt id=distinctconfig-12><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-12>12</a>
</span><span class=lnt id=distinctconfig-13><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-13>13</a>
</span><span class=lnt id=distinctconfig-14><a style=outline:none;text-decoration:none;color:inherit href=#distinctconfig-14>14</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>private</span> <span class=k>readonly</span> <span class=n>IHost</span> <span class=n>host</span><span class=p>;</span>
<span class=k>public</span> <span class=n>DistinctBenchmark</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>host</span> <span class=p>=</span> <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>context</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>services</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>DistinctHandler</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;,</span> <span class=n>GenericUploader</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;,</span> <span class=n>GenericUploader</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;,</span> <span class=n>GenericUploader</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;&gt;()</span>
        <span class=p>).</span><span class=n>Build</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
<p>IGenericUploader is defined as below.
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=distinctinterface-1><a style=outline:none;text-decoration:none;color:inherit href=#distinctinterface-1>1</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#>    <span class=k>public</span> <span class=k>interface</span> <span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=p>:</span> <span class=n>IFileUploader</span> <span class=k>where</span> <span class=n>T</span> <span class=p>:</span> <span class=n>IFileUploader</span> <span class=p>{</span> <span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
<p>GenericUploader is defined as below.
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=distinctimplementation-1><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-1> 1</a>
</span><span class=lnt id=distinctimplementation-2><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-2> 2</a>
</span><span class=lnt id=distinctimplementation-3><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-3> 3</a>
</span><span class=lnt id=distinctimplementation-4><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-4> 4</a>
</span><span class=lnt id=distinctimplementation-5><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-5> 5</a>
</span><span class=lnt id=distinctimplementation-6><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-6> 6</a>
</span><span class=lnt id=distinctimplementation-7><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-7> 7</a>
</span><span class=lnt id=distinctimplementation-8><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-8> 8</a>
</span><span class=lnt id=distinctimplementation-9><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-9> 9</a>
</span><span class=lnt id=distinctimplementation-10><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-10>10</a>
</span><span class=lnt id=distinctimplementation-11><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-11>11</a>
</span><span class=lnt id=distinctimplementation-12><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-12>12</a>
</span><span class=lnt id=distinctimplementation-13><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-13>13</a>
</span><span class=lnt id=distinctimplementation-14><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-14>14</a>
</span><span class=lnt id=distinctimplementation-15><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-15>15</a>
</span><span class=lnt id=distinctimplementation-16><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-16>16</a>
</span><span class=lnt id=distinctimplementation-17><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-17>17</a>
</span><span class=lnt id=distinctimplementation-18><a style=outline:none;text-decoration:none;color:inherit href=#distinctimplementation-18>18</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>GenericUploader</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=p>:</span> <span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=k>where</span> <span class=n>T</span> <span class=p>:</span> <span class=n>IFileUploader</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>T</span> <span class=m>_</span><span class=n>implementation</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>GenericUploader</span><span class=p>(</span><span class=n>T</span> <span class=n>implementation</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>implementation</span> <span class=p>=</span> <span class=n>implementation</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=kt>string</span> <span class=n>GetName</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=m>_</span><span class=n>implementation</span><span class=p>.</span><span class=n>GetName</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>UploadFile</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>implementation</span><span class=p>.</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
</ul>
<p>A new generic provider is defined (implementing the relevant interface) and the generic provider wraps the &ldquo;true provider&rdquo; implementation. As the generic implementation takes a T argument, this can be used to uniquely distinguish them and retrieve the correct implementation.</p>
<ul>
<li>
<p><strong>Usage:</strong><br>
The generic interface with the required implementation is now injected into the relevant class (<a class=link href=#distinctusage-4>line 4</a>) and is then invoked (<a class=link href=#distinctusage-11>line 11</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=distinctusage-1><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-1> 1</a>
</span><span class=lnt id=distinctusage-2><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-2> 2</a>
</span><span class=lnt id=distinctusage-3><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-3> 3</a>
</span><span class=lnt id=distinctusage-4><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-4> 4</a>
</span><span class=lnt id=distinctusage-5><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-5> 5</a>
</span><span class=lnt id=distinctusage-6><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-6> 6</a>
</span><span class=lnt id=distinctusage-7><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-7> 7</a>
</span><span class=lnt id=distinctusage-8><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-8> 8</a>
</span><span class=lnt id=distinctusage-9><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-9> 9</a>
</span><span class=lnt id=distinctusage-10><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-10>10</a>
</span><span class=lnt id=distinctusage-11><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-11>11</a>
</span><span class=lnt id=distinctusage-12><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-12>12</a>
</span><span class=lnt id=distinctusage-13><a style=outline:none;text-decoration:none;color:inherit href=#distinctusage-13>13</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>DistinctHandler</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;</span> <span class=m>_</span><span class=n>uploader</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>DistinctHandler</span><span class=p>(</span><span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;</span> <span class=n>uploader</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>uploader</span> <span class=p>=</span> <span class=n>uploader</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>uploader</span><span class=p>.</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Pros:</strong></p>
<ul>
<li>Not all implementations are instantiated</li>
<li>The default DI container is doing all the retrieval work (as a unique item is being asked for), so is very efficient</li>
<li>By far the best performing (in both time and memory usage) technique so far</li>
</ul>
</li>
<li>
<p><strong>Cons:</strong></p>
<ul>
<li>Implementation can NOT be selected/changed at runtime</li>
<li>Bit of a convoluted process having a wrapper interface</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
<th style=text-align:right>Mean</th>
<th style=text-align:right>Error</th>
<th style=text-align:right>StdDev</th>
<th style=text-align:right>Ratio</th>
<th style=text-align:right>RatioSD</th>
<th style=text-align:right>Gen 0</th>
<th style=text-align:right>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enumerable</td>
<td>Execute</td>
<td style=text-align:right>86.99 ns</td>
<td style=text-align:right>0.987 ns</td>
<td style=text-align:right>0.924 ns</td>
<td style=text-align:right>1.00</td>
<td style=text-align:right>0.00</td>
<td style=text-align:right>0.0421</td>
<td style=text-align:right>264 B</td>
</tr>
<tr>
<td>Factory</td>
<td>Execute</td>
<td style=text-align:right>103.20 ns</td>
<td style=text-align:right>1.324 ns</td>
<td style=text-align:right>1.238 ns</td>
<td style=text-align:right>1.19</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0459</td>
<td style=text-align:right>288 B</td>
</tr>
<tr>
<td>TypeFactory</td>
<td>Execute</td>
<td style=text-align:right>525.19 ns</td>
<td style=text-align:right>2.624 ns</td>
<td style=text-align:right>2.455 ns</td>
<td style=text-align:right>6.04</td>
<td style=text-align:right>0.07</td>
<td style=text-align:right>0.0277</td>
<td style=text-align:right>176 B</td>
</tr>
<tr>
<td>Delegate</td>
<td>Execute</td>
<td style=text-align:right>111.45 ns</td>
<td style=text-align:right>1.456 ns</td>
<td style=text-align:right>1.291 ns</td>
<td style=text-align:right>1.28</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0178</td>
<td style=text-align:right>112 B</td>
</tr>
<tr>
<td>TypeDelegate</td>
<td>Execute</td>
<td style=text-align:right>861.84 ns</td>
<td style=text-align:right>6.599 ns</td>
<td style=text-align:right>5.850 ns</td>
<td style=text-align:right>9.90</td>
<td style=text-align:right>0.15</td>
<td style=text-align:right>0.0343</td>
<td style=text-align:right>216 B</td>
</tr>
<tr>
<td>Distinct</td>
<td>Execute</td>
<td style=text-align:right>50.78 ns</td>
<td style=text-align:right>0.441 ns</td>
<td style=text-align:right>0.413 ns</td>
<td style=text-align:right>0.58</td>
<td style=text-align:right>0.01</td>
<td style=text-align:right>0.0038</td>
<td style=text-align:right>24 B</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr>
<h3 id=distinct-factory>Distinct Factory</h3>
<p>This technique extends the <code>Distinct</code> approach, resolving the limitation of not being able to select or change the implementation at runtime.</p>
<ul>
<li>
<p><strong>Configuration:</strong><br>
Setup very similar to the <code>Distinct</code> setup, with the addition of the DistinctFactory (<a class=link href=#distinctfactoryconfig-9>line 9</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=distinctfactoryconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-1> 1</a>
</span><span class=lnt id=distinctfactoryconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-2> 2</a>
</span><span class=lnt id=distinctfactoryconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-3> 3</a>
</span><span class=lnt id=distinctfactoryconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-4> 4</a>
</span><span class=lnt id=distinctfactoryconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-5> 5</a>
</span><span class=lnt id=distinctfactoryconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-6> 6</a>
</span><span class=lnt id=distinctfactoryconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-7> 7</a>
</span><span class=lnt id=distinctfactoryconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-8> 8</a>
</span><span class=lnt id=distinctfactoryconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-9> 9</a>
</span><span class=lnt id=distinctfactoryconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-10>10</a>
</span><span class=lnt id=distinctfactoryconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-11>11</a>
</span><span class=lnt id=distinctfactoryconfig-12><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-12>12</a>
</span><span class=lnt id=distinctfactoryconfig-13><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-13>13</a>
</span><span class=lnt id=distinctfactoryconfig-14><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-14>14</a>
</span><span class=lnt id=distinctfactoryconfig-15><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryconfig-15>15</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>private</span> <span class=k>readonly</span> <span class=n>IHost</span> <span class=n>host</span><span class=p>;</span>
<span class=k>public</span> <span class=n>DistinctFactoryBenchmark</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>host</span> <span class=p>=</span> <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>context</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>services</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>DistinctFactory</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>DistinctFactoryHandler</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;,</span> <span class=n>GenericUploader</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;,</span> <span class=n>GenericUploader</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;&gt;()</span>
            <span class=p>.</span><span class=n>AddScoped</span><span class=p>&lt;</span><span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;,</span> <span class=n>GenericUploader</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;&gt;()</span>
        <span class=p>).</span><span class=n>Build</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
<p>IGenericUploader and GenericUploader are exactly as defined in the <code>Distinct</code> technique.</p>
<p>DistinctFactoryHandler is defined as below.
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=distinctfactoryfactory-1><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-1> 1</a>
</span><span class=lnt id=distinctfactoryfactory-2><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-2> 2</a>
</span><span class=lnt id=distinctfactoryfactory-3><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-3> 3</a>
</span><span class=lnt id=distinctfactoryfactory-4><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-4> 4</a>
</span><span class=lnt id=distinctfactoryfactory-5><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-5> 5</a>
</span><span class=lnt id=distinctfactoryfactory-6><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-6> 6</a>
</span><span class=lnt id=distinctfactoryfactory-7><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-7> 7</a>
</span><span class=lnt id=distinctfactoryfactory-8><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-8> 8</a>
</span><span class=lnt id=distinctfactoryfactory-9><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-9> 9</a>
</span><span class=lnt id=distinctfactoryfactory-10><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-10>10</a>
</span><span class=lnt id=distinctfactoryfactory-11><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-11>11</a>
</span><span class=lnt id=distinctfactoryfactory-12><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-12>12</a>
</span><span class=lnt id=distinctfactoryfactory-13><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-13>13</a>
</span><span class=lnt id=distinctfactoryfactory-14><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-14>14</a>
</span><span class=lnt id=distinctfactoryfactory-15><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-15>15</a>
</span><span class=lnt id=distinctfactoryfactory-16><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-16>16</a>
</span><span class=lnt id=distinctfactoryfactory-17><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-17>17</a>
</span><span class=lnt id=distinctfactoryfactory-18><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-18>18</a>
</span><span class=lnt id=distinctfactoryfactory-19><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-19>19</a>
</span><span class=lnt id=distinctfactoryfactory-20><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-20>20</a>
</span><span class=lnt id=distinctfactoryfactory-21><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-21>21</a>
</span><span class=lnt id=distinctfactoryfactory-22><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-22>22</a>
</span><span class=lnt id=distinctfactoryfactory-23><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-23>23</a>
</span><span class=lnt id=distinctfactoryfactory-24><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-24>24</a>
</span><span class=lnt id=distinctfactoryfactory-25><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-25>25</a>
</span><span class=lnt id=distinctfactoryfactory-26><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-26>26</a>
</span><span class=lnt id=distinctfactoryfactory-27><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryfactory-27>27</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>DistinctFactory</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>IServiceProvider</span> <span class=m>_</span><span class=n>provider</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>DistinctFactory</span><span class=p>(</span><span class=n>IServiceProvider</span> <span class=n>provider</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>provider</span> <span class=p>=</span> <span class=n>provider</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=n>IFileUploader</span> <span class=n>Resolve</span><span class=p>(</span><span class=kt>string</span> <span class=n>providerName</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>switch</span> <span class=p>(</span><span class=n>providerName</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=k>case</span> <span class=s>&#34;aws&#34;</span><span class=p>:</span>
                <span class=k>return</span> <span class=m>_</span><span class=n>provider</span><span class=p>.</span><span class=n>GetService</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span>
                    <span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;))</span> <span class=k>as</span> <span class=n>IFileUploader</span><span class=p>;</span>
            <span class=k>case</span> <span class=s>&#34;azure&#34;</span><span class=p>:</span>
                <span class=k>return</span> <span class=m>_</span><span class=n>provider</span><span class=p>.</span><span class=n>GetService</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span>
                    <span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;))</span> <span class=k>as</span> <span class=n>IFileUploader</span><span class=p>;</span>
            <span class=k>case</span> <span class=s>&#34;ftp&#34;</span><span class=p>:</span>
                <span class=k>return</span> <span class=m>_</span><span class=n>provider</span><span class=p>.</span><span class=n>GetService</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span>
                    <span class=n>IGenericUploader</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;))</span> <span class=k>as</span> <span class=n>IFileUploader</span><span class=p>;</span>
            <span class=k>default</span><span class=p>:</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>ArgumentException</span><span class=p>(</span><span class=s>$&#34;No uploader with &#34;</span> <span class=p>+</span>
                               <span class=s>$&#34;name {providerName} could be found&#34;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Usage:</strong><br>
The factory is now injected into the relevant class (<a class=link href=#distinctfactoryusage-4>line 4</a>) and is then invoked to get the requested implementation by name (<a class=link href=#distinctfactoryusage-11>line 11</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=distinctfactoryusage-1><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-1> 1</a>
</span><span class=lnt id=distinctfactoryusage-2><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-2> 2</a>
</span><span class=lnt id=distinctfactoryusage-3><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-3> 3</a>
</span><span class=lnt id=distinctfactoryusage-4><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-4> 4</a>
</span><span class=lnt id=distinctfactoryusage-5><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-5> 5</a>
</span><span class=lnt id=distinctfactoryusage-6><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-6> 6</a>
</span><span class=lnt id=distinctfactoryusage-7><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-7> 7</a>
</span><span class=lnt id=distinctfactoryusage-8><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-8> 8</a>
</span><span class=lnt id=distinctfactoryusage-9><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-9> 9</a>
</span><span class=lnt id=distinctfactoryusage-10><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-10>10</a>
</span><span class=lnt id=distinctfactoryusage-11><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-11>11</a>
</span><span class=lnt id=distinctfactoryusage-12><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-12>12</a>
</span><span class=lnt id=distinctfactoryusage-13><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-13>13</a>
</span><span class=lnt id=distinctfactoryusage-14><a style=outline:none;text-decoration:none;color:inherit href=#distinctfactoryusage-14>14</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#> <span class=k>public</span> <span class=k>class</span> <span class=nc>DistinctFactoryHandler</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>DistinctFactory</span> <span class=m>_d</span><span class=n>istinctFactory</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>DistinctFactoryHandler</span><span class=p>(</span><span class=n>DistinctFactory</span> <span class=n>distinctFactory</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_d</span><span class=n>istinctFactory</span> <span class=p>=</span> <span class=n>distinctFactory</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=m>_d</span><span class=n>istinctFactory</span><span class=p>.</span><span class=n>Resolve</span><span class=p>(</span><span class=s>&#34;ftp&#34;</span><span class=p>).</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>

<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Pros:</strong></p>
<ul>
<li>Not all implementations are instantiated</li>
<li>Implementation can be selected/changed at runtime</li>
<li>Good overall performance</li>
</ul>
</li>
<li>
<p><strong>Cons:</strong></p>
<ul>
<li>Switch statement is hardcoded and needs to be manually maintained every time a new provider is added</li>
<li>Bit of a convoluted process</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
<th style=text-align:right>Mean</th>
<th style=text-align:right>Error</th>
<th style=text-align:right>StdDev</th>
<th style=text-align:right>Ratio</th>
<th style=text-align:right>RatioSD</th>
<th style=text-align:right>Gen 0</th>
<th style=text-align:right>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enumerable</td>
<td>Execute</td>
<td style=text-align:right>86.99 ns</td>
<td style=text-align:right>0.987 ns</td>
<td style=text-align:right>0.924 ns</td>
<td style=text-align:right>1.00</td>
<td style=text-align:right>0.00</td>
<td style=text-align:right>0.0421</td>
<td style=text-align:right>264 B</td>
</tr>
<tr>
<td>Factory</td>
<td>Execute</td>
<td style=text-align:right>103.20 ns</td>
<td style=text-align:right>1.324 ns</td>
<td style=text-align:right>1.238 ns</td>
<td style=text-align:right>1.19</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0459</td>
<td style=text-align:right>288 B</td>
</tr>
<tr>
<td>TypeFactory</td>
<td>Execute</td>
<td style=text-align:right>525.19 ns</td>
<td style=text-align:right>2.624 ns</td>
<td style=text-align:right>2.455 ns</td>
<td style=text-align:right>6.04</td>
<td style=text-align:right>0.07</td>
<td style=text-align:right>0.0277</td>
<td style=text-align:right>176 B</td>
</tr>
<tr>
<td>Delegate</td>
<td>Execute</td>
<td style=text-align:right>111.45 ns</td>
<td style=text-align:right>1.456 ns</td>
<td style=text-align:right>1.291 ns</td>
<td style=text-align:right>1.28</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0178</td>
<td style=text-align:right>112 B</td>
</tr>
<tr>
<td>TypeDelegate</td>
<td>Execute</td>
<td style=text-align:right>861.84 ns</td>
<td style=text-align:right>6.599 ns</td>
<td style=text-align:right>5.850 ns</td>
<td style=text-align:right>9.90</td>
<td style=text-align:right>0.15</td>
<td style=text-align:right>0.0343</td>
<td style=text-align:right>216 B</td>
</tr>
<tr>
<td>Distinct</td>
<td>Execute</td>
<td style=text-align:right>50.78 ns</td>
<td style=text-align:right>0.441 ns</td>
<td style=text-align:right>0.413 ns</td>
<td style=text-align:right>0.58</td>
<td style=text-align:right>0.01</td>
<td style=text-align:right>0.0038</td>
<td style=text-align:right>24 B</td>
</tr>
<tr>
<td>DistinctFactory</td>
<td>Execute</td>
<td style=text-align:right>96.22 ns</td>
<td style=text-align:right>1.378 ns</td>
<td style=text-align:right>1.289 ns</td>
<td style=text-align:right>1.11</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0076</td>
<td style=text-align:right>48 B</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr>
<h3 id=distinct-lookup-factory>Distinct Lookup Factory</h3>
<p>This approach gives implementations names as they are added to the DI container, keeps track of the name-implementation link, and facilitates lookup and retrieval of the correct implementation.</p>
<ul>
<li>
<p><strong>Configuration:</strong><br>
This setup is different, in that implementations of the same interface are grouped together by the AddNamedUploader extension method (<a class=link href=#lookupdistinctconfig-6>line 6</a>), and as implementations are added, they are given a name.
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=lookupdistinctconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-1> 1</a>
</span><span class=lnt id=lookupdistinctconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-2> 2</a>
</span><span class=lnt id=lookupdistinctconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-3> 3</a>
</span><span class=lnt id=lookupdistinctconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-4> 4</a>
</span><span class=lnt id=lookupdistinctconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-5> 5</a>
</span><span class=lnt id=lookupdistinctconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-6> 6</a>
</span><span class=lnt id=lookupdistinctconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-7> 7</a>
</span><span class=lnt id=lookupdistinctconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-8> 8</a>
</span><span class=lnt id=lookupdistinctconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-9> 9</a>
</span><span class=lnt id=lookupdistinctconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-10>10</a>
</span><span class=lnt id=lookupdistinctconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-11>11</a>
</span><span class=lnt id=lookupdistinctconfig-12><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-12>12</a>
</span><span class=lnt id=lookupdistinctconfig-13><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig-13>13</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>private</span> <span class=k>readonly</span> <span class=n>IHost</span> <span class=n>host</span><span class=p>;</span>
<span class=k>public</span> <span class=n>DistinctLookupFactoryBenchmark</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>host</span> <span class=p>=</span> <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>context</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>services</span>
            <span class=p>.</span><span class=n>AddNamedUploader</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;(</span><span class=n>builder</span> <span class=p>=&gt;</span> <span class=n>builder</span>
                <span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=s>&#34;aws&#34;</span><span class=p>,</span> <span class=k>typeof</span><span class=p>(</span><span class=n>AWSUploader</span><span class=p>))</span>
                <span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=s>&#34;azure&#34;</span><span class=p>,</span> <span class=k>typeof</span><span class=p>(</span><span class=n>AzureUploader</span><span class=p>))</span>
                <span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=s>&#34;ftp&#34;</span><span class=p>,</span> <span class=k>typeof</span><span class=p>(</span><span class=n>FTPUploader</span><span class=p>))</span>
            <span class=p>)</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>DistinctLookupFactoryHandler</span><span class=p>&gt;()</span>
        <span class=p>).</span><span class=n>Build</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
<p>There are a number of new components here:</p>
<ol>
<li>AddNamedUploader extension method (<a class=link href=#lookupdistinctconfig-6>line 6</a>): this will setup base functionality required as expose the UploaderBuilder as a parameter</li>
<li>builder, of type UploaderBuilder (<a class=link href=#lookupdistinctconfig-6>line 6</a>): this is an Action which handles keeping track of the name-implementation link.</li>
<li>AddTransient extension method (<a class=link href=#lookupdistinctconfig-7>lines 7-9</a>): this is <strong>not</strong> the same as the normal AddTransient method on IServiceCollection, but an extension method on the builder (UploaderBuilder) which wraps the usual .NET AddTransient method.</li>
</ol>
<p>The full definition of the classes (along with all other code) can be found on <a class=link href=https://github.com/always-developing/Rollcall.Extensions.Microsoft.DependencyInjection/tree/main/benchmark/MultiImplementationBenchark/8.DistinctLookupFactory target=_blank rel=noopener>Github, here</a></p>
<p>In summary though, it works as follows:</p>
<ol>
<li>
<p><em>AddNamedUploader</em> creates an instance of <em>UploaderTypes</em>, which keeps track of the name and the implementation Type. <em>UploaderTypes</em> is added to the DI container as a singleton.
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=lookupdistinctconfig2-1><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-1> 1</a>
</span><span class=lnt id=lookupdistinctconfig2-2><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-2> 2</a>
</span><span class=lnt id=lookupdistinctconfig2-3><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-3> 3</a>
</span><span class=lnt id=lookupdistinctconfig2-4><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-4> 4</a>
</span><span class=lnt id=lookupdistinctconfig2-5><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-5> 5</a>
</span><span class=lnt id=lookupdistinctconfig2-6><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-6> 6</a>
</span><span class=lnt id=lookupdistinctconfig2-7><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-7> 7</a>
</span><span class=lnt id=lookupdistinctconfig2-8><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-8> 8</a>
</span><span class=lnt id=lookupdistinctconfig2-9><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-9> 9</a>
</span><span class=lnt id=lookupdistinctconfig2-10><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-10>10</a>
</span><span class=lnt id=lookupdistinctconfig2-11><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-11>11</a>
</span><span class=lnt id=lookupdistinctconfig2-12><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig2-12>12</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>static</span> <span class=n>IServiceCollection</span> <span class=n>AddNamedUploader</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span>
    <span class=k>this</span> <span class=n>IServiceCollection</span> <span class=n>services</span><span class=p>,</span> 
    <span class=n>Action</span><span class=p>&lt;</span><span class=n>UploaderBuilder</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;&gt;</span> <span class=n>builder</span><span class=p>)</span> <span class=k>where</span> <span class=n>T</span> <span class=p>:</span> <span class=k>class</span>
<span class=p>{</span>
    <span class=kt>var</span> <span class=n>uploaderType</span> <span class=p>=</span> <span class=k>new</span> <span class=n>UploaderTypes</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;();</span>
    <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>(</span><span class=n>uploaderType</span><span class=p>);</span>
    <span class=n>services</span><span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>DistinctLookupFactory</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;));</span>

    <span class=n>builder</span><span class=p>.</span><span class=n>Invoke</span><span class=p>(</span><span class=k>new</span> <span class=n>UploaderBuilder</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span><span class=n>services</span><span class=p>,</span> <span class=n>uploaderType</span><span class=p>));</span>

    <span class=k>return</span> <span class=n>services</span><span class=p>;</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p>The <em>AddTransient</em> method will add records to the <em>UploaderTypes</em> class, as well as add the implementation to the DI container.
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=lookupdistinctconfig3-1><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig3-1> 1</a>
</span><span class=lnt id=lookupdistinctconfig3-2><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig3-2> 2</a>
</span><span class=lnt id=lookupdistinctconfig3-3><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig3-3> 3</a>
</span><span class=lnt id=lookupdistinctconfig3-4><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig3-4> 4</a>
</span><span class=lnt id=lookupdistinctconfig3-5><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig3-5> 5</a>
</span><span class=lnt id=lookupdistinctconfig3-6><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig3-6> 6</a>
</span><span class=lnt id=lookupdistinctconfig3-7><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig3-7> 7</a>
</span><span class=lnt id=lookupdistinctconfig3-8><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig3-8> 8</a>
</span><span class=lnt id=lookupdistinctconfig3-9><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig3-9> 9</a>
</span><span class=lnt id=lookupdistinctconfig3-10><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctconfig3-10>10</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>static</span> <span class=n>UploaderBuilder</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span>
    <span class=k>this</span> <span class=n>UploaderBuilder</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=n>builder</span><span class=p>,</span> 
    <span class=kt>string</span> <span class=n>name</span><span class=p>,</span> 
    <span class=n>Type</span> <span class=n>implementation</span><span class=p>)</span> <span class=k>where</span> <span class=n>T</span> <span class=p>:</span> <span class=k>class</span>
<span class=p>{</span>
    <span class=n>builder</span><span class=p>.</span><span class=n>Types</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>implementation</span><span class=p>);</span>
    <span class=n>builder</span><span class=p>.</span><span class=n>Services</span><span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=n>implementation</span><span class=p>);</span>

    <span class=k>return</span> <span class=n>builder</span><span class=p>;</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
</ol>
</li>
<li>
<p><strong>Usage:</strong><br>
The factory is now injected into the relevant class (<a class=link href=#lookupdistinctusage-4>line 4</a>) for a specific interface, and is then invoked to get the requested implementation by name (<a class=link href=#lookupdistinctusage-12>line 12</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=lookupdistinctusage-1><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-1> 1</a>
</span><span class=lnt id=lookupdistinctusage-2><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-2> 2</a>
</span><span class=lnt id=lookupdistinctusage-3><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-3> 3</a>
</span><span class=lnt id=lookupdistinctusage-4><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-4> 4</a>
</span><span class=lnt id=lookupdistinctusage-5><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-5> 5</a>
</span><span class=lnt id=lookupdistinctusage-6><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-6> 6</a>
</span><span class=lnt id=lookupdistinctusage-7><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-7> 7</a>
</span><span class=lnt id=lookupdistinctusage-8><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-8> 8</a>
</span><span class=lnt id=lookupdistinctusage-9><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-9> 9</a>
</span><span class=lnt id=lookupdistinctusage-10><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-10>10</a>
</span><span class=lnt id=lookupdistinctusage-11><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-11>11</a>
</span><span class=lnt id=lookupdistinctusage-12><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-12>12</a>
</span><span class=lnt id=lookupdistinctusage-13><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-13>13</a>
</span><span class=lnt id=lookupdistinctusage-14><a style=outline:none;text-decoration:none;color:inherit href=#lookupdistinctusage-14>14</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>DistinctLookupFactoryHandler</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>DistinctLookupFactory</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;</span> <span class=m>_d</span><span class=n>istinctFactory</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>DistinctLookupFactoryHandler</span><span class=p>(</span>
        <span class=n>DistinctLookupFactory</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;</span> <span class=n>distinctFactory</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_d</span><span class=n>istinctFactory</span> <span class=p>=</span> <span class=n>distinctFactory</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=m>_d</span><span class=n>istinctFactory</span><span class=p>.</span><span class=n>Resolve</span><span class=p>(</span><span class=s>&#34;ftp&#34;</span><span class=p>).</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Pros:</strong></p>
<ul>
<li>Not all implementations are instantiated</li>
<li>Implementation can be selected/changed at runtime</li>
<li>Good overall performance</li>
<li>No hard coded switch statement which needs to be maintained</li>
</ul>
</li>
<li>
<p><strong>Cons:</strong></p>
<ul>
<li>The most complicated to setup, with the most moving parts</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
<th style=text-align:right>Mean</th>
<th style=text-align:right>Error</th>
<th style=text-align:right>StdDev</th>
<th style=text-align:right>Ratio</th>
<th style=text-align:right>RatioSD</th>
<th style=text-align:right>Gen 0</th>
<th style=text-align:right>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enumerable</td>
<td>Execute</td>
<td style=text-align:right>86.99 ns</td>
<td style=text-align:right>0.987 ns</td>
<td style=text-align:right>0.924 ns</td>
<td style=text-align:right>1.00</td>
<td style=text-align:right>0.00</td>
<td style=text-align:right>0.0421</td>
<td style=text-align:right>264 B</td>
</tr>
<tr>
<td>Factory</td>
<td>Execute</td>
<td style=text-align:right>103.20 ns</td>
<td style=text-align:right>1.324 ns</td>
<td style=text-align:right>1.238 ns</td>
<td style=text-align:right>1.19</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0459</td>
<td style=text-align:right>288 B</td>
</tr>
<tr>
<td>TypeFactory</td>
<td>Execute</td>
<td style=text-align:right>525.19 ns</td>
<td style=text-align:right>2.624 ns</td>
<td style=text-align:right>2.455 ns</td>
<td style=text-align:right>6.04</td>
<td style=text-align:right>0.07</td>
<td style=text-align:right>0.0277</td>
<td style=text-align:right>176 B</td>
</tr>
<tr>
<td>Delegate</td>
<td>Execute</td>
<td style=text-align:right>111.45 ns</td>
<td style=text-align:right>1.456 ns</td>
<td style=text-align:right>1.291 ns</td>
<td style=text-align:right>1.28</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0178</td>
<td style=text-align:right>112 B</td>
</tr>
<tr>
<td>TypeDelegate</td>
<td>Execute</td>
<td style=text-align:right>861.84 ns</td>
<td style=text-align:right>6.599 ns</td>
<td style=text-align:right>5.850 ns</td>
<td style=text-align:right>9.90</td>
<td style=text-align:right>0.15</td>
<td style=text-align:right>0.0343</td>
<td style=text-align:right>216 B</td>
</tr>
<tr>
<td>Distinct</td>
<td>Execute</td>
<td style=text-align:right>50.78 ns</td>
<td style=text-align:right>0.441 ns</td>
<td style=text-align:right>0.413 ns</td>
<td style=text-align:right>0.58</td>
<td style=text-align:right>0.01</td>
<td style=text-align:right>0.0038</td>
<td style=text-align:right>24 B</td>
</tr>
<tr>
<td>DistinctFactory</td>
<td>Execute</td>
<td style=text-align:right>96.22 ns</td>
<td style=text-align:right>1.378 ns</td>
<td style=text-align:right>1.289 ns</td>
<td style=text-align:right>1.11</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0076</td>
<td style=text-align:right>48 B</td>
</tr>
<tr>
<td>DistinctLookupFactory</td>
<td>Execute</td>
<td style=text-align:right>92.96 ns</td>
<td style=text-align:right>0.764 ns</td>
<td style=text-align:right>0.714 ns</td>
<td style=text-align:right>1.07</td>
<td style=text-align:right>0.01</td>
<td style=text-align:right>0.0126</td>
<td style=text-align:right>80 B</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=rollcall>Rollcall</h3>
<p><code>Rollcall</code> is a library (written by me) which extends the <code>DistinctLookupFactory</code> approach and makes it generic so that it will function with any interface and implementation. <a class=link href=https://www.nuget.org/packages/Rollcall.Extensions.Microsoft.DependencyInjection/ target=_blank rel=noopener>Rollcall is available on Nuget</a></p>
<ul>
<li>
<p><strong>Configuration:</strong><br>
The setup is almost identical to the <code>DistinctLookupFactory</code>, but without the need for the factory, as this is built into the <code>Rollcall</code> library.
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=rollcallconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-1> 1</a>
</span><span class=lnt id=rollcallconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-2> 2</a>
</span><span class=lnt id=rollcallconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-3> 3</a>
</span><span class=lnt id=rollcallconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-4> 4</a>
</span><span class=lnt id=rollcallconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-5> 5</a>
</span><span class=lnt id=rollcallconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-6> 6</a>
</span><span class=lnt id=rollcallconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-7> 7</a>
</span><span class=lnt id=rollcallconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-8> 8</a>
</span><span class=lnt id=rollcallconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-9> 9</a>
</span><span class=lnt id=rollcallconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-10>10</a>
</span><span class=lnt id=rollcallconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-11>11</a>
</span><span class=lnt id=rollcallconfig-12><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-12>12</a>
</span><span class=lnt id=rollcallconfig-13><a style=outline:none;text-decoration:none;color:inherit href=#rollcallconfig-13>13</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>private</span> <span class=k>readonly</span> <span class=n>IHost</span> <span class=n>host</span><span class=p>;</span>
<span class=k>public</span> <span class=n>RollcallBenchmark</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>host</span> <span class=p>=</span> <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>context</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>services</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>RollcallHandler</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddNamedService</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;(</span><span class=n>builder</span> <span class=p>=&gt;</span> <span class=n>builder</span>
                <span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=s>&#34;aws&#34;</span><span class=p>,</span> <span class=k>typeof</span><span class=p>(</span><span class=n>AWSUploader</span><span class=p>))</span>
                <span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=s>&#34;azure&#34;</span><span class=p>,</span> <span class=k>typeof</span><span class=p>(</span><span class=n>AzureUploader</span><span class=p>))</span>
                <span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=s>&#34;ftp&#34;</span><span class=p>,</span> <span class=k>typeof</span><span class=p>(</span><span class=n>FTPUploader</span><span class=p>))</span>
            <span class=p>)</span>
        <span class=p>).</span><span class=n>Build</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Usage:</strong><br>
The Rollcall provider/factory is now injected into the relevant class (<a class=link href=#rollcallusage-4>line 4</a>) for a specific interface, and is then invoked to get the requested implementation by name (<a class=link href=#rollcallusage-12>line 12</a>)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=rollcallusage-1><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-1> 1</a>
</span><span class=lnt id=rollcallusage-2><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-2> 2</a>
</span><span class=lnt id=rollcallusage-3><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-3> 3</a>
</span><span class=lnt id=rollcallusage-4><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-4> 4</a>
</span><span class=lnt id=rollcallusage-5><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-5> 5</a>
</span><span class=lnt id=rollcallusage-6><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-6> 6</a>
</span><span class=lnt id=rollcallusage-7><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-7> 7</a>
</span><span class=lnt id=rollcallusage-8><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-8> 8</a>
</span><span class=lnt id=rollcallusage-9><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-9> 9</a>
</span><span class=lnt id=rollcallusage-10><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-10>10</a>
</span><span class=lnt id=rollcallusage-11><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-11>11</a>
</span><span class=lnt id=rollcallusage-12><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-12>12</a>
</span><span class=lnt id=rollcallusage-13><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-13>13</a>
</span><span class=lnt id=rollcallusage-14><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-14>14</a>
</span><span class=lnt id=rollcallusage-15><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-15>15</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>RollcallHandler</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>IRollcallProvider</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;</span> <span class=m>_</span><span class=n>provider</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>RollcallHandler</span><span class=p>(</span><span class=n>IRollcallProvider</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;</span> <span class=n>provider</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>provider</span> <span class=p>=</span> <span class=n>provider</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>providerName</span> <span class=p>=</span> <span class=s>&#34;aws&#34;</span><span class=p>;</span>
        <span class=kt>var</span> <span class=n>uploader</span> <span class=p>=</span> <span class=m>_</span><span class=n>provider</span><span class=p>.</span><span class=n>GetService</span><span class=p>(</span><span class=n>providerName</span><span class=p>);</span>
        <span class=n>uploader</span><span class=p>.</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div>
Not shown above, but one could also inject IServiceProvider and used the provided GetService extension method to get the service by name.</p>
</li>
<li>
<p><strong>Pros:</strong></p>
<ul>
<li>Not all implementations are instantiated</li>
<li>Implementation can be selected/changed at runtime</li>
<li>Good overall performance</li>
<li>No hard coded switch statement which needs to be maintained</li>
<li>Works with any interface + implementation, and provides all functionality out the box</li>
</ul>
</li>
<li>
<p><strong>Cons:</strong></p>
<ul>
<li>Slight performance overhead when compared to the non-generic method</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
<th style=text-align:right>Mean</th>
<th style=text-align:right>Error</th>
<th style=text-align:right>StdDev</th>
<th style=text-align:right>Ratio</th>
<th style=text-align:right>RatioSD</th>
<th style=text-align:right>Gen 0</th>
<th style=text-align:right>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enumerable</td>
<td>Execute</td>
<td style=text-align:right>86.99 ns</td>
<td style=text-align:right>0.987 ns</td>
<td style=text-align:right>0.924 ns</td>
<td style=text-align:right>1.00</td>
<td style=text-align:right>0.00</td>
<td style=text-align:right>0.0421</td>
<td style=text-align:right>264 B</td>
</tr>
<tr>
<td>Factory</td>
<td>Execute</td>
<td style=text-align:right>103.20 ns</td>
<td style=text-align:right>1.324 ns</td>
<td style=text-align:right>1.238 ns</td>
<td style=text-align:right>1.19</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0459</td>
<td style=text-align:right>288 B</td>
</tr>
<tr>
<td>TypeFactory</td>
<td>Execute</td>
<td style=text-align:right>525.19 ns</td>
<td style=text-align:right>2.624 ns</td>
<td style=text-align:right>2.455 ns</td>
<td style=text-align:right>6.04</td>
<td style=text-align:right>0.07</td>
<td style=text-align:right>0.0277</td>
<td style=text-align:right>176 B</td>
</tr>
<tr>
<td>Delegate</td>
<td>Execute</td>
<td style=text-align:right>111.45 ns</td>
<td style=text-align:right>1.456 ns</td>
<td style=text-align:right>1.291 ns</td>
<td style=text-align:right>1.28</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0178</td>
<td style=text-align:right>112 B</td>
</tr>
<tr>
<td>TypeDelegate</td>
<td>Execute</td>
<td style=text-align:right>861.84 ns</td>
<td style=text-align:right>6.599 ns</td>
<td style=text-align:right>5.850 ns</td>
<td style=text-align:right>9.90</td>
<td style=text-align:right>0.15</td>
<td style=text-align:right>0.0343</td>
<td style=text-align:right>216 B</td>
</tr>
<tr>
<td>Distinct</td>
<td>Execute</td>
<td style=text-align:right>50.78 ns</td>
<td style=text-align:right>0.441 ns</td>
<td style=text-align:right>0.413 ns</td>
<td style=text-align:right>0.58</td>
<td style=text-align:right>0.01</td>
<td style=text-align:right>0.0038</td>
<td style=text-align:right>24 B</td>
</tr>
<tr>
<td>DistinctFactory</td>
<td>Execute</td>
<td style=text-align:right>96.22 ns</td>
<td style=text-align:right>1.378 ns</td>
<td style=text-align:right>1.289 ns</td>
<td style=text-align:right>1.11</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0076</td>
<td style=text-align:right>48 B</td>
</tr>
<tr>
<td>DistinctLookupFactory</td>
<td>Execute</td>
<td style=text-align:right>92.96 ns</td>
<td style=text-align:right>0.764 ns</td>
<td style=text-align:right>0.714 ns</td>
<td style=text-align:right>1.07</td>
<td style=text-align:right>0.01</td>
<td style=text-align:right>0.0126</td>
<td style=text-align:right>80 B</td>
</tr>
<tr>
<td>Rollcall</td>
<td>Execute</td>
<td style=text-align:right>124.52 ns</td>
<td style=text-align:right>1.485 ns</td>
<td style=text-align:right>1.389 ns</td>
<td style=text-align:right>1.43</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0076</td>
<td style=text-align:right>48 B</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=rollcall-with-func>Rollcall with Func</h3>
<p><code>Rollcall</code> can also be used with a implementation factory, a Func&lt;IServiceProvider,object> method. This method is called when requesting the implementation by name from the DI container. <a class=link href=https://www.nuget.org/packages/Rollcall.Extensions.Microsoft.DependencyInjection/ target=_blank rel=noopener>Available on NuGet.</a></p>
<ul>
<li>
<p><strong>Configuration:</strong><br>
The setup is a little more complicated than before, as some of the configuration needs to be done manually (instead of by the <code>Rollcall</code> package)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=rollcallfuncconfig-1><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-1> 1</a>
</span><span class=lnt id=rollcallfuncconfig-2><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-2> 2</a>
</span><span class=lnt id=rollcallfuncconfig-3><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-3> 3</a>
</span><span class=lnt id=rollcallfuncconfig-4><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-4> 4</a>
</span><span class=lnt id=rollcallfuncconfig-5><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-5> 5</a>
</span><span class=lnt id=rollcallfuncconfig-6><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-6> 6</a>
</span><span class=lnt id=rollcallfuncconfig-7><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-7> 7</a>
</span><span class=lnt id=rollcallfuncconfig-8><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-8> 8</a>
</span><span class=lnt id=rollcallfuncconfig-9><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-9> 9</a>
</span><span class=lnt id=rollcallfuncconfig-10><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-10>10</a>
</span><span class=lnt id=rollcallfuncconfig-11><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-11>11</a>
</span><span class=lnt id=rollcallfuncconfig-12><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-12>12</a>
</span><span class=lnt id=rollcallfuncconfig-13><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-13>13</a>
</span><span class=lnt id=rollcallfuncconfig-14><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-14>14</a>
</span><span class=lnt id=rollcallfuncconfig-15><a style=outline:none;text-decoration:none;color:inherit href=#rollcallfuncconfig-15>15</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>private</span> <span class=k>readonly</span> <span class=n>IHost</span> <span class=n>host</span><span class=p>;</span>
<span class=k>public</span> <span class=n>RollcallFuncBenchmark</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>host</span> <span class=p>=</span> <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>context</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>services</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>RollcallFuncHandler</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>AWSUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>AzureUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>FTPUploader</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>AddNamedService</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;(</span><span class=n>builder</span> <span class=p>=&gt;</span> <span class=n>builder</span>
                <span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=s>&#34;aws&#34;</span><span class=p>,</span> <span class=n>sp</span> <span class=p>=&gt;</span> <span class=n>sp</span><span class=p>.</span><span class=n>GetService</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>AWSUploader</span><span class=p>)))</span>
                <span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=s>&#34;azure&#34;</span><span class=p>,</span> <span class=n>sp</span> <span class=p>=&gt;</span> <span class=n>sp</span><span class=p>.</span><span class=n>GetService</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>AzureUploader</span><span class=p>)))</span>
                <span class=p>.</span><span class=n>AddTransient</span><span class=p>(</span><span class=s>&#34;ftp&#34;</span><span class=p>,</span> <span class=n>sp</span> <span class=p>=&gt;</span> <span class=n>sp</span><span class=p>.</span><span class=n>GetService</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>FTPUploader</span><span class=p>)))</span>
            <span class=p>)).</span><span class=n>Build</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p><strong>Usage:</strong><br>
The usage is exactly the same with the Func&lt;> as with the normal interface + implementation (as shown above)
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt id=rollcallusage-1><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-1> 1</a>
</span><span class=lnt id=rollcallusage-2><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-2> 2</a>
</span><span class=lnt id=rollcallusage-3><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-3> 3</a>
</span><span class=lnt id=rollcallusage-4><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-4> 4</a>
</span><span class=lnt id=rollcallusage-5><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-5> 5</a>
</span><span class=lnt id=rollcallusage-6><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-6> 6</a>
</span><span class=lnt id=rollcallusage-7><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-7> 7</a>
</span><span class=lnt id=rollcallusage-8><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-8> 8</a>
</span><span class=lnt id=rollcallusage-9><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-9> 9</a>
</span><span class=lnt id=rollcallusage-10><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-10>10</a>
</span><span class=lnt id=rollcallusage-11><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-11>11</a>
</span><span class=lnt id=rollcallusage-12><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-12>12</a>
</span><span class=lnt id=rollcallusage-13><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-13>13</a>
</span><span class=lnt id=rollcallusage-14><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-14>14</a>
</span><span class=lnt id=rollcallusage-15><a style=outline:none;text-decoration:none;color:inherit href=#rollcallusage-15>15</a>
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=k>public</span> <span class=k>class</span> <span class=nc>RollcallFuncHandler</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=k>readonly</span> <span class=n>IRollcallProvider</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;</span> <span class=m>_</span><span class=n>provider</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>RollcallFuncHandler</span><span class=p>(</span><span class=n>IRollcallProvider</span><span class=p>&lt;</span><span class=n>IFileUploader</span><span class=p>&gt;</span> <span class=n>provider</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=m>_</span><span class=n>provider</span> <span class=p>=</span> <span class=n>provider</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>void</span> <span class=n>Execute</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>providerName</span> <span class=p>=</span> <span class=s>&#34;aws&#34;</span><span class=p>;</span>
        <span class=kt>var</span> <span class=n>uploader</span> <span class=p>=</span> <span class=m>_</span><span class=n>provider</span><span class=p>.</span><span class=n>GetService</span><span class=p>(</span><span class=n>providerName</span><span class=p>);</span>
        <span class=n>uploader</span><span class=p>.</span><span class=n>UploadFile</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></td></tr></table>
</div>
</div>
Not shown above, but one could also inject IServiceProvider and used the provided GetService extension method to get the service by name.</p>
</li>
<li>
<p><strong>Pros:</strong></p>
<ul>
<li>Not all implementations are instantiated</li>
<li>Implementation can be selected/changed at runtime</li>
<li>Good overall performance</li>
<li>No hard coded switch statement which needs to be maintained</li>
<li>Works with any interface + func&lt;>, and provides all functionality out the box</li>
</ul>
</li>
<li>
<p><strong>Cons:</strong></p>
<ul>
<li>Slight performance overhead when compared to the non-generic method, and when compared
to the interface + implementation method.</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
<th style=text-align:right>Mean</th>
<th style=text-align:right>Error</th>
<th style=text-align:right>StdDev</th>
<th style=text-align:right>Ratio</th>
<th style=text-align:right>RatioSD</th>
<th style=text-align:right>Gen 0</th>
<th style=text-align:right>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enumerable</td>
<td>Execute</td>
<td style=text-align:right>86.99 ns</td>
<td style=text-align:right>0.987 ns</td>
<td style=text-align:right>0.924 ns</td>
<td style=text-align:right>1.00</td>
<td style=text-align:right>0.00</td>
<td style=text-align:right>0.0421</td>
<td style=text-align:right>264 B</td>
</tr>
<tr>
<td>Factory</td>
<td>Execute</td>
<td style=text-align:right>103.20 ns</td>
<td style=text-align:right>1.324 ns</td>
<td style=text-align:right>1.238 ns</td>
<td style=text-align:right>1.19</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0459</td>
<td style=text-align:right>288 B</td>
</tr>
<tr>
<td>TypeFactory</td>
<td>Execute</td>
<td style=text-align:right>525.19 ns</td>
<td style=text-align:right>2.624 ns</td>
<td style=text-align:right>2.455 ns</td>
<td style=text-align:right>6.04</td>
<td style=text-align:right>0.07</td>
<td style=text-align:right>0.0277</td>
<td style=text-align:right>176 B</td>
</tr>
<tr>
<td>Delegate</td>
<td>Execute</td>
<td style=text-align:right>111.45 ns</td>
<td style=text-align:right>1.456 ns</td>
<td style=text-align:right>1.291 ns</td>
<td style=text-align:right>1.28</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0178</td>
<td style=text-align:right>112 B</td>
</tr>
<tr>
<td>TypeDelegate</td>
<td>Execute</td>
<td style=text-align:right>861.84 ns</td>
<td style=text-align:right>6.599 ns</td>
<td style=text-align:right>5.850 ns</td>
<td style=text-align:right>9.90</td>
<td style=text-align:right>0.15</td>
<td style=text-align:right>0.0343</td>
<td style=text-align:right>216 B</td>
</tr>
<tr>
<td>Distinct</td>
<td>Execute</td>
<td style=text-align:right>50.78 ns</td>
<td style=text-align:right>0.441 ns</td>
<td style=text-align:right>0.413 ns</td>
<td style=text-align:right>0.58</td>
<td style=text-align:right>0.01</td>
<td style=text-align:right>0.0038</td>
<td style=text-align:right>24 B</td>
</tr>
<tr>
<td>DistinctFactory</td>
<td>Execute</td>
<td style=text-align:right>96.22 ns</td>
<td style=text-align:right>1.378 ns</td>
<td style=text-align:right>1.289 ns</td>
<td style=text-align:right>1.11</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0076</td>
<td style=text-align:right>48 B</td>
</tr>
<tr>
<td>DistinctLookupFactory</td>
<td>Execute</td>
<td style=text-align:right>92.96 ns</td>
<td style=text-align:right>0.764 ns</td>
<td style=text-align:right>0.714 ns</td>
<td style=text-align:right>1.07</td>
<td style=text-align:right>0.01</td>
<td style=text-align:right>0.0126</td>
<td style=text-align:right>80 B</td>
</tr>
<tr>
<td>Rollcall</td>
<td>Execute</td>
<td style=text-align:right>124.52 ns</td>
<td style=text-align:right>1.485 ns</td>
<td style=text-align:right>1.389 ns</td>
<td style=text-align:right>1.43</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0076</td>
<td style=text-align:right>48 B</td>
</tr>
<tr>
<td>RollcallFunc</td>
<td>Execute</td>
<td style=text-align:right>134.68 ns</td>
<td style=text-align:right>1.224 ns</td>
<td style=text-align:right>1.085 ns</td>
<td style=text-align:right>1.55</td>
<td style=text-align:right>0.02</td>
<td style=text-align:right>0.0076</td>
<td style=text-align:right>48 B</td>
</tr>
</tbody>
</table>
<hr>
<h2 id=conclusion>Conclusion</h2>
<p>There are a variety of ways to handle multiple implementations of the same interface, none of which are wrong. However, not all are suitable for every situation and using the incorrect one for the situation could result in a performance impact.<br>
There are trade-offs and pros and cons to using each technique - the most performant might be the most difficult to maintain for your situation.<br>
<strong>Test the various methods and find which works best and is most optimal for your particular situation.</strong></p>
<h2 id=references-and-links>References and links</h2>
<p><a class=link href=https://github.com/always-developing/Rollcall.Extensions.Microsoft.DependencyInjection target=_blank rel=noopener>Rollcall Github repo</a><br>
<a class=link href=https://www.nuget.org/packages/Rollcall.Extensions.Microsoft.DependencyInjection/ target=_blank rel=noopener>Rollcall Nuget package</a></p>
<hr>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/c#/>c#</a>
<a href=/tags/.net/>.net</a>
<a href=/tags/dependency-injection/>dependency injection</a>
<a href=/tags/di/>DI</a>
<a href=/tags/dependency/>dependency</a>
<a href=/tags/injection/>injection</a>
<a href=/tags/rollcall/>rollcall</a>
<a href=/tags/transient/>transient</a>
<a href=/tags/singleton/>singleton</a>
<a href=/tags/scoped/>scoped</a>
<a href=/tags/multiple-implementation/>multiple implementation</a>
<a href=/tags/implementation/>implementation</a>
<a href=/tags/interface/>interface</a>
<a href=/tags/multiple/>multiple</a>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/p/vs-keyboard-shortcuts/>
<div class=article-details>
<h2 class=article-title>Useful Visual Studio keyboard shortcuts</h2>
</div>
</a>
</article>
<article>
<a href=/p/string-vs-string/>
<div class=article-details>
<h2 class=article-title>C# String vs string</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<script src=https://giscus.app/client.js data-repo=always-developing/always-developing.github.io data-repo-id=R_kgDOGQJLBQ data-category=Comments data-category-id=DIC_kwDOGQJLBc4B_pUA data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-theme=light crossorigin=anonymous async></script>
<script>function setGiscusTheme(b){let a=document.querySelector('iframe.giscus-frame');a&&a.contentWindow.postMessage({giscus:{setConfig:{theme:b}}},"https://giscus.app")}(function(){addEventListener('message',b=>{if(event.origin!=='https://giscus.app')return;a()}),window.addEventListener('onColorSchemeChange',a);function a(){document.documentElement.dataset.scheme==="light"?setGiscusTheme('light'):setGiscusTheme('dark')}})()</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 Always Developing
</section>
<section class=powerby>
Always Developing | always learning | always growing <br>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#the-challenge>The challenge</a></li>
<li><a href=#the-problem-with-net-dependency-injection-container>The problem with .NET dependency injection container</a></li>
<li><a href=#the-different-techniques>The different techniques</a>
<ol>
<li><a href=#ienumerable>IEnumerable</a></li>
<li><a href=#factory>Factory</a></li>
<li><a href=#type-factory>Type Factory</a></li>
<li><a href=#delegate>Delegate</a></li>
<li><a href=#type-delegate>Type Delegate</a></li>
<li><a href=#distinct>Distinct</a></li>
<li><a href=#distinct-factory>Distinct Factory</a></li>
<li><a href=#distinct-lookup-factory>Distinct Lookup Factory</a></li>
<li><a href=#rollcall>Rollcall</a></li>
<li><a href=#rollcall-with-func>Rollcall with Func</a></li>
</ol>
</li>
<li><a href=#conclusion>Conclusion</a></li>
<li><a href=#references-and-links>References and links</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>